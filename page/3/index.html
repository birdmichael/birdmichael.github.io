<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="BirdMichael">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="BirdMichael">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BirdMichael">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/3/"/>

  <title> BirdMichael </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">BirdMichael</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/07/ios-video-player-how-to-force-the-rotating-screen/" itemprop="url">
                  iOS视频播放等如何强制旋转屏幕
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-10-07T03:42:36+08:00" content="2015-10-07">
              2015-10-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/未分类/" itemprop="url" rel="index">
                    <span itemprop="name">未分类</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>如果做过项目中有视频播放的内容 一定遇到过全屏播放视频的需求 一般来说 直接弹出一个modal viewcontroller来全屏播放视频就ok了</p>
<p>但是为了用户体验 可能需要在同一个viewcontroller中进行全屏和非全屏的切换 这个时候可能就需要强制旋转屏幕来做到</p>
<p>那么如何完美的对屏幕进行强制旋转呢?</p>
<p>这里只讨论ios6+的方法(因为从ios6+起 屏幕旋转的api做了重要的变化 有需要的同学可以自己去探索一下ios6-的方法)</p>
<h1 id="研究"><a href="#研究" class="headerlink" title="研究"></a>研究</h1><p>首先 你得在项目的的plist中或者target的general选项里配置好APP所支持的所有放心啊个</p>
<p>然后 在ios6+之后 屏幕旋转的控制权交给了rootViewController(这里没探讨presentViewController的情况 只考虑普通的布局) 那么基本上所有的APP都是基于UINavigationController或者UITabbarViewController做为rootViewController的 所以要灵活的控制每个push进来的view的旋转 需要修改一下UINavigationController或者UITabbarViewController的以下几个方法(可以添加Category 也可以继承一下)</p>
<p><pre class="lang:objc decode:true ">//UINavigationController</pre></p>
<ul>
<li><p>(BOOL)shouldAutorotate<br>{<br>  return self.topViewController.shouldAutorotate;<br>}</p>
</li>
<li><p>(NSUInteger)supportedInterfaceOrientations<br>{<br>  return self.topViewController.supportedInterfaceOrientations;<br>}</p>
</li>
<li><p>(UIInterfaceOrientation)preferredInterfaceOrientationForPresentation<br>{<br>  return self.topViewController.preferredInterfaceOrientationForPresentation;<br>}</p>
</li>
</ul>
<p>//UITabbarViewController<br>//注意 这里的selectedViewController如果是UINavigationController的话 也需要对它做上面的修改</p>
<ul>
<li><p>(BOOL)shouldAutorotate<br>{<br>  return self.selectedViewController.shouldAutorotate;<br>}</p>
</li>
<li><p>(NSUInteger)supportedInterfaceOrientations<br>{<br>  return self.selectedViewController.supportedInterfaceOrientations;<br>}</p>
</li>
<li><p>(UIInterfaceOrientation)preferredInterfaceOrientationForPresentation<br>{<br>  return self.selectedViewController.preferredInterfaceOrientationForPresentation;<br>}<br>&nbsp;</p>
</li>
</ul>
<p>这样 控制旋转的主动权就交还到了每个viewController的手上了</p>
<h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><p>在ios6中 使用如下的trick可以强制让屏幕进行旋转检测</p>
<p><pre class="lang:objc decode:true ">UIViewController *vc = [[UIViewController alloc]init];<br>[self presentModalViewController:vc animated:NO];<br>[self dismissModalViewControllerAnimated:NO];</pre><br>&nbsp;</p>
<p>在ios7中 上面的方法不管用了 但是稍微改一改就可以了</p>
<p><pre class="lang:objc decode:true">   UIViewController *vc  = [[UIViewController alloc] init];<br>[self presentViewController:viewController animated:NO completion:^{<br>       [self dismissViewControllerAnimated:NO completion:nil];<br>}];</pre><br>虽然上面的办法确实可以触发对屏幕旋转的判断 但缺陷就是旋转起来不自然</p>
<p>实际上有个更好的方法</p>
<p><pre class="lang:objc decode:true">   [[UIDevice currentDevice] setValue:<br>    [NSNumber numberWithInteger: self.isFullScreen?UIInterfaceOrientationLandscapeRight:UIInterfaceOrientationPortrait]<br>                               forKey:@”orientation”];</pre></p>
<p>//等价于<br>objc_msgSend([UIDevice currentDevice], @selector(setOrientation:), self.isFullScreen?UIInterfaceOrientationLandscapeRight:UIInterfaceOrientationPortrait);<br>在stackoverflow上看到有人说 此方法是私有方法 调用有可能会导致被reject，但是目前实测是没有影响的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/29/instancetype-instead-of-the-id-is-used-as-the-return-type-what-are-the-benefits/" itemprop="url">
                  用instancetype代替id作返回类型有什么好处？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-29T21:23:36+08:00" content="2015-09-29">
              2015-09-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Steven Fisher</strong>：只要一个类返回自身的实例，用instancetype就有好处。</p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true">@interface Foo:NSObject</pre></p>
<ul>
<li>(id)initWithBar:(NSInteger)bar; // initializer</li>
</ul>
<ul>
<li>(id)fooWithBar:(NSInteger)bar;  // convenience constructor<br>@end<br><br>对于简易构造函数(convenience constructor)，应该总是用instancetype。编译器不会自动将id转化为instancetype。id是通用对象，但如果你用instancetype，编译器就知道方法返回什么类型的对象。</li>
</ul>
<p>这个问题可不只有学术意义，比如，[[NSFileHandle fileHandleWithStandardOutput] writeData:formattedData]在Mac OS X（只在该OS版本）中会报错“Multiple methods named ‘writeData:’ found with mismatched result, parameter type or attributes.”原因是NSFileHandle和NSURLHandle都提供writeData:方法。由于[NSFileHandle fileHandleWithStandardOutput] 返回的类型是id，编译器并不确定请求了哪个类的writeData:方法。</p>
<p>你可以用</p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true">[(NSFileHandle *)[NSFileHandle fileHandleWithStandardOutput] writeData:formattedData];</pre><br>或</p>
<p><pre class="lang:objc decode:true">NSFileHandle *fileHandle = [NSFileHandle fileHandleWithStandardOutput];<br>[fileHandle writeData:formattedData];</pre><br></p>
<p><div class="highlight"></div><br>来绕过。</p>
<p>当然，更好的方法是声明fileHandleWithStandardOutput的返回类型为instancetype。(注意：这段样例代码在iOS中并不会报错，因为iOS中只有NSFileHandle提供writeData:方法。但length等方法则会，UILayoutSupport会返回CGFloat，而NSString则会返回NSUInteger)</p>
<p>initializer的情况更复杂，当你输入</p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true">- (id)initWithBar:(NSInteger)bar</pre><br><br>编译器会假设你输入了</p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true">- (instancetype)initWithBar:(NSInteger)bar</pre><br><br>对于ARC而言，这是必须的。<a href="http://clang.llvm.org/docs/LanguageExtensions.html#related-result-types" target="_blank" rel="external">Clang Language Extensions</a>的相关结果类型(Related result types)也讲到了这一点。也许别人会据此告诉你不必使用instancetype，但我建议你用它。下面解释我为什么如此建议。</p>
<p>使用instancetype有三点好处：</p>
<p>1、明确性。代码只做你让它做的事，而不是其他。</p>
<p>2、程式化。你会养成好习惯，这些习惯在某些时候会很有用，而且肯定有用武之地。</p>
<p>3、一致性。让代码可读性更好。</p>
<p><strong>明确性</strong></p>
<p>用instancetype代替id作为返回值的确没有<em>技术上的好处</em>。但这是因为编译器自动将id转化成了instancetype。你以为init返回的值类型是id，其实编译器返回了instancetype。</p>
<p>这两行代码对于编译器来说是<em>一样</em>的：</p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true">- (id)initWithBar:(NSInteger)bar;</pre></p>
<ul>
<li>(instancetype)initWithBar:(NSInteger)bar;<br><br>但在你眼里，这两行代码却不同。<strong>你不该学着忽视它。</strong></li>
</ul>
<p><strong>模式化</strong></p>
<p>在使用init等方法时的确没有区别，但在定义简易构造函数时就<strong>有</strong>区别了。</p>
<p>这两行代码并不等价：</p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true">+ (id)fooWithBar:(NSInteger)bar;</pre></p>
<ul>
<li>(instancetype)fooWithBar:(NSInteger)bar;<br><br>如果用instancetype作为函数的返回类型，就不会出错。</li>
</ul>
<p><strong>一致性：</strong></p>
<p>最后，想象把所有东西放到一起时的情景：你想要一个init方法和一个简易构造函数。</p>
<p>如果你用id来作为init函数的返回类型，最终代码如下：</p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true ">- (id)initWithBar:(NSInteger)bar;</pre></p>
<ul>
<li>(instancetype)fooWithBar:(NSInteger)bar;<br>但如果你用instancetype，代码如下：</li>
</ul>
<p></p>
<p><div class="highlight"></div></p>
<p><pre class="lang:objc decode:true  ">- (instancetype)initWithBar:(NSInteger)bar;</pre></p>
<ul>
<li>(instancetype)fooWithBar:(NSInteger)bar;<br><br>代码更加一致，可读性更强。它们返回相同的东西，这一点一目了然。</li>
</ul>
<p><strong>结论</strong></p>
<p>除非你有意为旧编译器写代码，不然你在合适的时候都应该用instancetype。</p>
<p>在写一条返回id的消息前，问自己：这个类返回实例吗？如果返回，用instancetype。</p>
<p>肯定有需要返回id的时候，但你用instancetype的频率应该会更高。</p>
<p><em>本答案最后编辑于2013年7月12日</em></p>
<p>原帖：<a href="http://stackoverflow.com/questions/8972221/would-it-be-beneficial-to-begin-using-instancetype-instead-of-id" target="_blank" rel="external">objective c - Would it be beneficial to begin using instancetype instead of id?</a></p>
<p>注意：我也是刚入门而已，如果翻译的术语与通行术语不一致，敬请告知；如果选取的翻译内容有误或过时，敬请告知，谢谢。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/20/use-system-comes-with-qr-codes-and-scanning/" itemprop="url">
                  使用系统自带二维码生成及扫描
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-20T23:03:34+08:00" content="2015-09-20">
              2015-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/IOS/" itemprop="url" rel="index">
                    <span itemprop="name">IOS</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/IOS/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h3><pre class="lang:objc decode:true ">   // 1.实例化二维码滤镜
    CIFilter *filter = [CIFilter filterWithName:@"CIQRCodeGenerator"];

    // 2.恢复滤镜的默认属性 (因为滤镜有可能保存上一次的属性)
    [filter setDefaults];

    // 3.将字符串转换成NSdata
    NSData *data  = [@"http://www.birdmichael.com" dataUsingEncoding:NSUTF8StringEncoding];

    // 4.通过KVO设置滤镜, 传入data, 将来滤镜就知道要通过传入的数据生成二维码
    [filter setValue:data forKey:@"inputMessage"];

    // 5.生成二维码
     CIImage *outputImage = [filter outputImage];

    // 6.得到image
    UIImage *image = [UIImage  imageWithCIImage:outputImage];</pre>

<h3 id="扫描二维码"><a href="#扫描二维码" class="headerlink" title="扫描二维码"></a>扫描二维码</h3><p><pre class="lang:objc decode:true ">#import “ViewController.h”</pre></p>
<p>#import &lt;AVFoundation/AVFoundation.h&gt;</p>
<p>@interface ViewController ()&lt;AVCaptureMetadataOutputObjectsDelegate&gt;<br>@property (nonatomic, strong) AVCaptureSession <em>session;<br>@property (nonatomic, strong) AVCaptureVideoPreviewLayer </em>previewLayer;<br>@end</p>
<p>@implementation ViewController</p>
<ul>
<li><p>(void)viewDidLoad {<br>  [super viewDidLoad];<br>  // Do any additional setup after loading the view, typically from a nib.</p>
<p>  // 1. 实例化拍摄设备<br>  AVCaptureDevice *device = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];</p>
<p>  // 2. 设置输入设备<br>  AVCaptureDeviceInput *input = [AVCaptureDeviceInput deviceInputWithDevice:device error:nil];</p>
<p>  // 3. 设置元数据输出<br>  // 3.1 实例化拍摄元数据输出<br>  AVCaptureMetadataOutput *output = [[AVCaptureMetadataOutput alloc] init];<br>  // 3.3 设置输出数据代理<br>  [output setMetadataObjectsDelegate:self queue:dispatch_get_main_queue()];</p>
<p>  // 4. 添加拍摄会话<br>  // 4.1 实例化拍摄会话<br>  AVCaptureSession *session = [[AVCaptureSession alloc] init];<br>  // 4.2 添加会话输入<br>  [session addInput:input];<br>  // 4.3 添加会话输出<br>  [session addOutput:output];<br>  // 4.3 设置输出数据类型，需要将元数据输出添加到会话后，才能指定元数据类型，否则会报错<br>  [output setMetadataObjectTypes:@[AVMetadataObjectTypeQRCode]];</p>
<p>  self.session = session;</p>
<p>  // 5. 视频预览图层<br>  // 5.1 实例化预览图层, 传递_session是为了告诉图层将来显示什么内容<br>  AVCaptureVideoPreviewLayer *preview = [AVCaptureVideoPreviewLayer layerWithSession:_session];</p>
<p>  preview.videoGravity = AVLayerVideoGravityResizeAspectFill;<br>  preview.frame = self.view.bounds;<br>  // 5.2 将图层插入当前视图<br>  [self.view.layer insertSublayer:preview atIndex:100];</p>
<p>  self.previewLayer = preview;</p>
<p>  // 6. 启动会话<br>  [_session startRunning];</p>
</li>
</ul>
<p>}</p>
<ul>
<li><p>(void)captureOutput:(AVCaptureOutput <em>)captureOutput didOutputMetadataObjects:(NSArray </em>)metadataObjects fromConnection:(AVCaptureConnection *)connection<br>{</p>
<p>  // 会频繁的扫描，调用代理方法<br>  // 1. 如果扫描完成，停止会话<br>  [self.session stopRunning];<br>  // 2. 删除预览图层<br>  [self.previewLayer removeFromSuperlayer];</p>
<p>  NSLog(@”%@”, metadataObjects);<br>  // 3. 设置界面显示扫描结果</p>
<p>  if (metadataObjects.count &gt; 0) {</p>
<pre><code>AVMetadataMachineReadableCodeObject *obj = metadataObjects[0];
// 提示：如果需要对url或者名片等信息进行扫描，可以在此进行扩展！
</code></pre><p>//        _label.text = obj.stringValue;</p>
<pre><code>NSLog(@&quot;%@&quot;, obj.stringValue);
</code></pre><p>  }<br>}<br>&nbsp;</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/20/static-library/" itemprop="url">
                  静态库
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-20T22:52:21+08:00" content="2015-09-20">
              2015-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>什么是库？</p>
<p>库是程序代码的集合，是共享程序代码的一种方式</p>
<p>根据源代码的公开情况，库可以分为2种类型</p>
<p>开源库—公开源代码，能看到具体实现 比如SDWebImage、AFNetworking</p>
<p>闭源库—不公开源代码，是经过编译后的二进制文件，看不到具体实现 主要分为：静态库、动态库</p>
<h1 id="01-为什么要做静态库"><a href="#01-为什么要做静态库" class="headerlink" title="01. 为什么要做静态库"></a>01. 为什么要做静态库</h1><p>1&gt; 国内的企业，掌握有核心技术，同时是又希望更多的程序员来使用其技术，因此采用”闭源”的方式开发使用<br>例如：百度地图，友盟，JPush等</p>
<p>2&gt; 在企业开发中，一些核心技术或者常用框架，出于安全性和稳定性的考虑，也会提供静态库给程序员使用</p>
<h1 id="02-静态库的特点"><a href="#02-静态库的特点" class="headerlink" title="02. 静态库的特点"></a>02. 静态库的特点</h1><p>.a + .h</p>
<h1 id="03-静态库简单演练"><a href="#03-静态库简单演练" class="headerlink" title="03. 静态库简单演练"></a>03. 静态库简单演练</h1><p>1&gt; 新建BMTools项目<br>2&gt; 创建一个类方法，实现一个简单的加法<br>3&gt; 编译</p>
<h1 id="注意，在编译静态库时，需要编译两个版本-gt-真机-arm-模拟器-i386"><a href="#注意，在编译静态库时，需要编译两个版本-gt-真机-arm-模拟器-i386" class="headerlink" title="注意，在编译静态库时，需要编译两个版本 -&gt; 真机(arm) | 模拟器(i386)"></a>注意，在编译静态库时，需要编译两个版本 -&gt; 真机(arm) | 模拟器(i386)</h1><p>4&gt; 新建项目将编译生成的.a + .h拖到项目中使用</p>
<h1 id="04-静态库中的资源包的使用"><a href="#04-静态库中的资源包的使用" class="headerlink" title="04. 静态库中的资源包的使用"></a>04. 静态库中的资源包的使用</h1><p>问题：有些第三方库会使用到一些图片素材，例如公司的logo等。</p>
<p>但是由于Xcode默认在编译时会把所有的素材文件导入到mainBundle中，为了避免与使用静态库的程序冲突。<br>在静态库中如果要使用图片素材，会利用bundle的手段</p>
<p>1&gt; 建立bundle，并且向其中添加图片<br>2&gt; 创建一个类方法，返回图片<br>3&gt; 编译<br>4&gt; 调用方如果需要使用，需要导入 .h + .a + XXX.bundle</p>
<h1 id="05-静态库中的自定义视图"><a href="#05-静态库中的自定义视图" class="headerlink" title="05. 静态库中的自定义视图"></a>05. 静态库中的自定义视图</h1><p>问题：程序需要测试<br>静态库如何测试呢？</p>
<p>创建复合项目</p>
<p>1&gt; 复习块代码传值</p>
<h1 id="06-静态库的使用"><a href="#06-静态库的使用" class="headerlink" title="06. 静态库的使用"></a>06. 静态库的使用</h1><p>新建项目将编译生成的.a + .h拖到项目中使用</p>
<h1 id="07-静态库的种类"><a href="#07-静态库的种类" class="headerlink" title="07. 静态库的种类"></a>07. 静态库的种类</h1><p>静态库文件的版本(4种)<br>1.真机-Debug版本<br>2.真机-Release版本<br>3.模拟器-Debug版本<br>4.模拟器-Release版本</p>
<h2 id="调试版本-VS-发布版本"><a href="#调试版本-VS-发布版本" class="headerlink" title="调试版本 VS 发布版本"></a>调试版本 VS 发布版本</h2><ul>
<li>调试版本会包含完整的符号信息，以方便调试</li>
<li><p>调试版本不会对代码进行优化</p>
</li>
<li><p>发布版本不会包含完整的符号信息</p>
</li>
<li>发布版本的执行代码是进行过优化的</li>
<li>发布版本的大小会比调试版本的略小</li>
<li>在执行速度方面，发布版本会更快些，但不意味着会有显著的提升</li>
</ul>
<h1 id="08-静态库的合并"><a href="#08-静态库的合并" class="headerlink" title="08. 静态库的合并"></a>08. 静态库的合并</h1><h1 id="检测-a的类型"><a href="#检测-a的类型" class="headerlink" title="检测.a的类型"></a>检测.a的类型</h1><p>$ lipo -info libBMToolss.a</p>
<h1 id="合并-a"><a href="#合并-a" class="headerlink" title="合并.a"></a>合并.a</h1><p>lipo -create Debug-iphoneos/libBMTools.a Debug-iphonesimulator/libBMTools.a -output libBMTools.a</p>
<h1 id="合并-a的好处，开发过程中既可以在真机上调试，也可以在模拟器上调试"><a href="#合并-a的好处，开发过程中既可以在真机上调试，也可以在模拟器上调试" class="headerlink" title="合并.a的好处，开发过程中既可以在真机上调试，也可以在模拟器上调试"></a>合并.a的好处，开发过程中既可以在真机上调试，也可以在模拟器上调试</h1><h1 id="合并-a的坏处，如果静态库太大，合并打包后，会非常大，因此很多第三方的静态库的-a是区分版本的"><a href="#合并-a的坏处，如果静态库太大，合并打包后，会非常大，因此很多第三方的静态库的-a是区分版本的" class="headerlink" title="合并.a的坏处，如果静态库太大，合并打包后，会非常大，因此很多第三方的静态库的.a是区分版本的"></a>合并.a的坏处，如果静态库太大，合并打包后，会非常大，因此很多第三方的静态库的.a是区分版本的</h1><h1 id="今后在使用-a时一定注意版本"><a href="#今后在使用-a时一定注意版本" class="headerlink" title="今后在使用.a时一定注意版本"></a>今后在使用.a时一定注意版本</h1><p>&nbsp;</p>
<p>静态库中包含了Category</p>
<p>如果静态库中包含了Category，有时候在使用静态库的工程中会报“方法找不到”的错误（unrecognized selector sent to instance）</p>
<p>解决方案：在使用静态库的工程中配置Other Linker Flags为-ObjC</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/16/remote-push-configuration-process/" itemprop="url">
                  远程推送应用配置过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-16T22:14:11+08:00" content="2015-09-16">
              2015-09-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1. 创建支持远程推送功能的App ID<br>2. 申请开发者证书，并选中刚刚创建的App ID<br>3. 下载CER文件，并导入钥匙串管理<br>4. 申请发布证书，并选中刚刚创建的App ID<br>5. 下载CER文件，并导入钥匙串管理<br>6. 检查App ID，确认证书已经指定</p>
<p>远程推送应用程序开发过程<br>1. 新建应用程序<br>2. 指定AppID，在developer.apple.com上设置的AppID</p>
<p><pre class="lang:objc decode:true ">#ifdef __IPHONE_8_0<br>// 注册接收通知的类型<br>UIUserNotificationSettings *settings = [UIUserNotificationSettings settingsForTypes:UIUserNotificationTypeAlert | UIUserNotificationTypeBadge | UIUserNotificationTypeSound categories:nil];<br>[application registerUserNotificationSettings:settings];</pre></p>
<p>// 注册允许接收远程推送通知<br>[application registerForRemoteNotifications];</p>
<p>#else<br>// 如果是iOS7.0，使用以下方法注册<br>[application registerForRemoteNotificationTypes:UIUserNotificationTypeAlert | UIUserNotificationTypeBadge | UIUserNotificationTypeSound];</p>
<p>#endif</p>
<p>// 当得到苹果的APNs服务器返回的DeviceToken就会被调用<br>// 7040f7d5 5a974598 c5cf31b5 3e340b39 68affd25 122f0ce1 3f315226 396c2e5b</p>
<ul>
<li>(void)application:(UIApplication <em>)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData </em>)deviceToken {<br>NSLog(@”deviceToken是：%@”, deviceToken);<br>}</li>
</ul>
<p>// 接收到远程通知，触发方法和本地通知一致</p>
<ul>
<li>(void)application:(UIApplication <em>)application didReceiveRemoteNotification:(NSDictionary </em>)userInfo {<br>NSLog(@”%@”, userInfo);<br>}<br>&nbsp;<br><em>*</em> 使用后台的远程消息推送</li>
</ul>
<p>1&gt; 在Capabilities中打开远程推送通知<br>2&gt; 实现代理方法</p>
<p><pre class="lang:objc decode:true ">- (void)application:(UIApplication <em>)application didReceiveRemoteNotification:(NSDictionary </em>)userInfo fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler</pre><br>&nbsp;</p>
<p>远程消息数据格式：<br>{“aps” : {“content-available” : 1},”name” : “birdmichael”}</p>
<p>执行completionHandler有两个目的<br>1&gt; 系统会估量App消耗的电量，并根据传递的UIBackgroundFetchResult 参数记录新数据是否可用<br>2&gt; 调用完成的处理代码时，应用的界面缩略图会自动更新</p>
<p>注意：接收到远程通知到执行完网络请求之间的时间不能超过30秒</p>
<p><pre class="lang:objc decode:true ">if (userInfo) {<br>int contentId = [userInfo[@”content-id”] intValue];</pre></p>
<p>ViewController <em>vc = (ViewController </em>)application.keyWindow.rootViewController;<br>[vc loadDataWithContentID:contentId completion:^(NSArray *dataList) {<br>vc.dataList = dataList;</p>
<p>NSLog(@”刷新数据结束”);</p>
<p>completionHandler(UIBackgroundFetchResultNewData);<br>}];<br>} else {<br>completionHandler(UIBackgroundFetchResultNoData);<br>}<br>&nbsp;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/11/cllocation-description/" itemprop="url">
                  CLLocation 常用说明
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-11T17:56:06+08:00" content="2015-09-11">
              2015-09-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="01-CLLocation"><a href="#01-CLLocation" class="headerlink" title="01. CLLocation"></a>01. CLLocation</h2><p>CLLocationManager 定位管理者<br>CLLocation 代表位置(经度/纬度/高度/速度/路线等)<br>CLHeading 代表移动方向<br>CLRegion 代表一个区域<br>&gt;CLCircularRegion 圆形区域<br>&gt;CLBeaconRegion 蓝牙信号区域</p>
<p>返回定位服务是否可用<br>[CLLocationManager locationServicesEnabled];<br>返回延迟定位更新是否可用<br>[CLLocationManager deferredLocationUpdatesAvailable];<br>返回重大位置改变监听是否可用<br>[CLLocationManager significantLocationChangeMonitoringAvailable];<br>返回是否支持磁力计算方向<br>[CLLocationManager headingAvailable];<br>返回蓝牙信号范围服务是否可用<br>[CLLocationManager isRangingAvailable];</p>
<hr>
<p>设置是否可以暂停定位来节省电池电量, YES不需要定位数据时自动暂停定位<br>// mgr.pausesLocationUpdatesAutomatically</p>
<hr>
<p>每隔多少米定位一次, 只有水平方向超过该值时才会重新定位<br>// mgr.distanceFilter = 100;</p>
<hr>
<p>定位精确度<br>// mgr.desiredAccuracy;<br>kCLDistanceFilterNone;<br>kCLLocationAccuracyBestForNavigation 导航级最佳精准<br>kCLLocationAccuracyBest; 最佳精准<br>kCLLocationAccuracyNearestTenMeters; 10米误差<br>kCLLocationAccuracyHundredMeters; 百米胡茬<br>kCLLocationAccuracyKilometer; 千米误差<br>kCLLocationAccuracyThreeKilometers; 3千米误差</p>
<hr>
<p>定位数据的用途<br>// mgr.activityType;<br>CLActivityTypeOther 作为普通用途<br>CLActivityTypeAutomotiveNavigation 作为车辆导航<br>CLActivityTypeFitness 作为不行<br>CLActivityTypeOtherNavigation 作为其它导航</p>
<hr>
<p>// CLLocation<br>location.coordinate; 坐标, 包含经纬度<br>location.altitude; 设备海拔高度 单位是米<br>location.course; 设置前进方向 0表示北 90东 180南 270西<br>location.horizontalAccuracy; 水平精准度<br>location.verticalAccuracy; 垂直精准度<br>location.timestamp; 定位信息返回的时间<br>location.speed; 设备移动速度 单位是米/秒, 适用于行车速度而不太适用于不行<br>/<em><br>可以设置模拟器模拟速度<br>bicycle ride 骑车移动<br>run 跑动<br>freeway drive 高速公路驾车
</em>/</p>
<hr>
<p>// CLAuthorizationStatus<br>用户从未选择过权限<br>kCLAuthorizationStatusNotDetermined<br>无法使用定位服务，该状态用户无法改变<br>kCLAuthorizationStatusRestricted<br>用户拒绝该应用使用定位服务，或是定位服务总开关处于关闭状态<br>kCLAuthorizationStatusDenied<br>已经授权（废弃）<br>kCLAuthorizationStatusAuthorized<br>用户允许该程序无论何时都可以使用地理信息<br>kCLAuthorizationStatusAuthorizedAlways<br>用户同意程序在可见时使用地理位置<br>kCLAuthorizationStatusAuthorizedWhenInUse</p>
<hr>
<p>// 计算两个位置之间的距离, 单位是米<br>[newLocation distanceFromLocation:self.prevLocation];</p>
<hr>
<p>获取方向信息不会提示用户(不需要授权), 因为不会泄露隐私<br>// [self.mgr startUpdatingHeading];</p>
<p>magneticHeading 设备与磁北的相对角度<br>trueHeading 设置与真北的相对角度, 必须和定位一起使用, iOS需要设置的位置来计算真北<br>真北始终指向地理北极点</p>
<h2 id="磁北对应随着时间变化的地球磁场北极"><a href="#磁北对应随着时间变化的地球磁场北极" class="headerlink" title="磁北对应随着时间变化的地球磁场北极"></a>磁北对应随着时间变化的地球磁场北极</h2><p>// 错误：使用CoreLocation获取地理位置信息，报错<br>Error Domain=kCLErrorDomain Code=0 “The operation couldn’t be completed. (kCLErrorDomain error 0.)”</p>
<p>解决方法：<br>1.确定模拟器（手机）已经联网并且允许程序获取地理位置<br>2.重置地理位置服务或者网络服务</p>
<p>PS：如果是模拟器就果断直接重置模拟器吧 IOS Simulator - Reset Content and Settings..。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/09/essential-guide-to-git-zero-process-code/" itemprop="url">
                  git零基础指南。。全过程代码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-09T13:01:46+08:00" content="2015-09-09">
              2015-09-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/其他/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="本地仓库操作"><a href="#本地仓库操作" class="headerlink" title="本地仓库操作"></a>本地仓库操作</h3><h1 id="01-GIT命令行帮助"><a href="#01-GIT命令行帮助" class="headerlink" title="01. GIT命令行帮助"></a><pre class="lang:objc decode:true">01. GIT命令行帮助</pre></h1><p>$ svn help<br>查看svn所有命令的帮助<br>$ svn help 子命令</p>
<h1 id="要退出帮助信息，按”q”"><a href="#要退出帮助信息，按”q”" class="headerlink" title="要退出帮助信息，按”q”"></a>要退出帮助信息，按”q”</h1><h1 id="翻看下页，按”空格”"><a href="#翻看下页，按”空格”" class="headerlink" title="翻看下页，按”空格”"></a>翻看下页，按”空格”</h1><h1 id="翻看上页，按”CTRL-B”"><a href="#翻看上页，按”CTRL-B”" class="headerlink" title="翻看上页，按”CTRL+B”"></a>翻看上页，按”CTRL+B”</h1><h1 id="要搜索相关文字，按”-“然后输入”相关文字”"><a href="#要搜索相关文字，按”-“然后输入”相关文字”" class="headerlink" title="要搜索相关文字，按”/“然后输入”相关文字”"></a>要搜索相关文字，按”/“然后输入”相关文字”</h1><h1 id="02-创建代码库-amp-配置个人信息"><a href="#02-创建代码库-amp-配置个人信息" class="headerlink" title="02. 创建代码库 &amp; 配置个人信息"></a>02. 创建代码库 &amp; 配置个人信息</h1><p>1&gt;  创建代码仓库<br>$ git init</p>
<p>2&gt;  配置用户名和邮箱<br>$ git config user.name birdmichael<br>$ git config user.email 229953445@qq.com</p>
<ul>
<li>以上两个命令会将用户信息保存在当前代码仓库中</li>
</ul>
<h1 id="只有配置了用户和邮箱之后，git才能识别出操作的人员信息，通过钩子-hooks-程序可以设置一些动作"><a href="#只有配置了用户和邮箱之后，git才能识别出操作的人员信息，通过钩子-hooks-程序可以设置一些动作" class="headerlink" title="只有配置了用户和邮箱之后，git才能识别出操作的人员信息，通过钩子(hooks)程序可以设置一些动作"></a>只有配置了用户和邮箱之后，git才能识别出操作的人员信息，通过钩子(hooks)程序可以设置一些动作</h1><h1 id="例如单元测试发现问题后，自动给相关人员发送电子邮件"><a href="#例如单元测试发现问题后，自动给相关人员发送电子邮件" class="headerlink" title="例如单元测试发现问题后，自动给相关人员发送电子邮件"></a>例如单元测试发现问题后，自动给相关人员发送电子邮件</h1><ul>
<li>注意 暂时不建议投入一毛钱精力</li>
</ul>
<p>3&gt;  如果要一次性配置完成可以使用一下命令<br>$ git config –global user.name birdmichael<br>$ git config –global user.email 229953445@qq.com</p>
<ul>
<li>以上两个命令会将用户信息保存在用户目录下的 .gitconfig 文件中</li>
</ul>
<p>4&gt;  查看当前所有配置<br>$ git config -l</p>
<h1 id="03-实际开发"><a href="#03-实际开发" class="headerlink" title="03. 实际开发"></a>03. 实际开发</h1><p>1&gt;  创建代码，开始开发<br>$ touch main.c<br>$ open main.c</p>
<p>2&gt;  将代码添加到代码库</p>
<h1 id="查看当前代码库状态"><a href="#查看当前代码库状态" class="headerlink" title="查看当前代码库状态"></a>查看当前代码库状态</h1><p>$ git status</p>
<h1 id="将文件添加到代码库"><a href="#将文件添加到代码库" class="headerlink" title="将文件添加到代码库"></a>将文件添加到代码库</h1><p>$ git add main.c</p>
<h1 id="将修改提交到代码库"><a href="#将修改提交到代码库" class="headerlink" title="将修改提交到代码库"></a>将修改提交到代码库</h1><p>$ git commit -m “添加了main.c”</p>
<p>提示：</p>
<ul>
<li>在此一定要使用 -m 参数指定修改的备注信息</li>
<li>否则会进入 vim 编辑器，如果对vim不熟悉，会是很糟糕的事情</li>
</ul>
<h1 id="将当前文件夹下的所有新建或修改的文件一次性添加到代码库"><a href="#将当前文件夹下的所有新建或修改的文件一次性添加到代码库" class="headerlink" title="将当前文件夹下的所有新建或修改的文件一次性添加到代码库"></a>将当前文件夹下的所有新建或修改的文件一次性添加到代码库</h1><p>$ git add .</p>
<p>3&gt;  添加多个文件<br>$ touch Person.h Person.m<br>$ git add .<br>$ git commit -m “添加了Person类”<br>$ open Person.h<br>$ git add .<br>$ git commit -m “增加Person类属性”</p>
<ul>
<li>注意 使用git时，每一次修改都需要添加再提交，这一点是与svn不一样的</li>
</ul>
<h2 id="git-的重要概念及工作原理"><a href="#git-的重要概念及工作原理" class="headerlink" title="git 的重要概念及工作原理"></a>git 的重要概念及工作原理</h2><p>工作区<br>暂存区(staged)<br>分支(HEAD)</p>
<h1 id="04-别名-amp-日志"><a href="#04-别名-amp-日志" class="headerlink" title="04. 别名 &amp; 日志"></a>04. 别名 &amp; 日志</h1><p>$ git config alias.st status<br>$ git config alias.ci “commit -m”</p>
<p>个人建议：除非特殊原因，最好不要设置别名，否则换一台机器就不会用了</p>
<h1 id="查看所有版本库日志"><a href="#查看所有版本库日志" class="headerlink" title="查看所有版本库日志"></a>查看所有版本库日志</h1><p>$ git log</p>
<h1 id="查看指定文件的版本库日志"><a href="#查看指定文件的版本库日志" class="headerlink" title="查看指定文件的版本库日志"></a>查看指定文件的版本库日志</h1><p>$ git log 文件名</p>
<h1 id="配置带颜色的log别名"><a href="#配置带颜色的log别名" class="headerlink" title="配置带颜色的log别名"></a>配置带颜色的log别名</h1><p>$ git config –global alias.lg “log –color –graph –pretty=format:’%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset’ –abbrev-commit”</p>
<p>提示：在git中，版本号是一个由SHA1生成的哈希值</p>
<h1 id="05-版本号，让我们在任意版本之间穿梭"><a href="#05-版本号，让我们在任意版本之间穿梭" class="headerlink" title="05. 版本号，让我们在任意版本之间穿梭"></a>05. 版本号，让我们在任意版本之间穿梭</h1><h1 id="回到当前版本，放弃所有没有提交的修改"><a href="#回到当前版本，放弃所有没有提交的修改" class="headerlink" title="回到当前版本，放弃所有没有提交的修改"></a>回到当前版本，放弃所有没有提交的修改</h1><p>$ git reset –hard HEAD</p>
<h1 id="回到上一个版本"><a href="#回到上一个版本" class="headerlink" title="回到上一个版本"></a>回到上一个版本</h1><p>$ git reset –hard HEAD^</p>
<h1 id="回到之前第3个修订版本"><a href="#回到之前第3个修订版本" class="headerlink" title="回到之前第3个修订版本"></a>回到之前第3个修订版本</h1><p>$ git reset –hard HEAD~(3)</p>
<h1 id="回到指定版本号的版本"><a href="#回到指定版本号的版本" class="headerlink" title="回到指定版本号的版本"></a>回到指定版本号的版本</h1><p>$ git reset e695b67</p>
<h1 id="查看分支引用记录"><a href="#查看分支引用记录" class="headerlink" title="查看分支引用记录"></a>查看分支引用记录</h1><p>$ git reflog</p>
<h1 id="07-单个文件的修改管理"><a href="#07-单个文件的修改管理" class="headerlink" title="07. 单个文件的修改管理"></a>07. 单个文件的修改管理</h1><h1 id="查看文件变化"><a href="#查看文件变化" class="headerlink" title="查看文件变化"></a>查看文件变化</h1><p>$ git diff</p>
<h1 id="撤销对文件做的修改"><a href="#撤销对文件做的修改" class="headerlink" title="撤销对文件做的修改"></a>撤销对文件做的修改</h1><p>$ git checkout Person.h</p>
<h1 id="从代码库（暂存区中删除文件）"><a href="#从代码库（暂存区中删除文件）" class="headerlink" title="从代码库（暂存区中删除文件）"></a>从代码库（暂存区中删除文件）</h1><h3 id="团队开发操作"><a href="#团队开发操作" class="headerlink" title="团队开发操作"></a>团队开发操作</h3><h1 id="01-建立代码仓库-专门用于团队开发的代码仓库"><a href="#01-建立代码仓库-专门用于团队开发的代码仓库" class="headerlink" title="01. 建立代码仓库(专门用于团队开发的代码仓库)"></a><pre class="lang:objc decode:true  ">01. 建立代码仓库(专门用于团队开发的代码仓库)</pre></h1><h1 id="切换目录"><a href="#切换目录" class="headerlink" title="切换目录"></a>切换目录</h1><p>$ cd /Users/bm/Desktop/git演练/公司/weibo</p>
<h1 id="建立空白代码库-专门用于团队开发"><a href="#建立空白代码库-专门用于团队开发" class="headerlink" title="建立空白代码库(专门用于团队开发)"></a>建立空白代码库(专门用于团队开发)</h1><p>$ git init –bare</p>
<h1 id="02-项目经理准备项目-前奏"><a href="#02-项目经理准备项目-前奏" class="headerlink" title="02. 项目经理准备项目(前奏)"></a>02. 项目经理准备项目(前奏)</h1><h1 id="切换目录-1"><a href="#切换目录-1" class="headerlink" title="切换目录"></a>切换目录</h1><p>$ cd /Users/bm/Desktop/git演练/经理</p>
<h1 id="“克隆”代码库到本地"><a href="#“克隆”代码库到本地" class="headerlink" title="“克隆”代码库到本地"></a>“克隆”代码库到本地</h1><p>$ git clone /Users/lnj/Desktop/git演练/公司/weibo/</p>
<h1 id="个人信息配置-因为要演示一台机器上的多人协作，日常开发可以忽略"><a href="#个人信息配置-因为要演示一台机器上的多人协作，日常开发可以忽略" class="headerlink" title="个人信息配置(因为要演示一台机器上的多人协作，日常开发可以忽略)"></a>个人信息配置(因为要演示一台机器上的多人协作，日常开发可以忽略)</h1><p>$ git config user.name manager<br>$ git config user.email manager@163.com</p>
<h2 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h2><p>.gitignore可以指定哪些文件不纳入版本库的管理</p>
<p>参考网址：<a href="https://github.com/github/gitignore" target="_blank" rel="external">https://github.com/github/gitignore</a></p>
<h1 id="命令行中进入与-git同级的目录"><a href="#命令行中进入与-git同级的目录" class="headerlink" title="命令行中进入与.git同级的目录"></a>命令行中进入与.git同级的目录</h1><p>$ cd /Users/bm/Desktop/git演练/经理/weibo</p>
<h2 id="将以下命令一次性粘贴到命令行中"><a href="#将以下命令一次性粘贴到命令行中" class="headerlink" title="将以下命令一次性粘贴到命令行中"></a>将以下命令一次性粘贴到命令行中</h2><p>echo -e “# Xcode<br>#<br>build/<br><em>.pbxuser
</em>.mode1v3<br><em>.mode2v3
</em>.perspectivev3<br>xcuserdata<br><em>.xccheckout
</em>.moved-aside<br>DerivedData<br><em>.hmap
</em>.ipa<br>*.xcuserstate</p>
<h1 id="CocoaPods"><a href="#CocoaPods" class="headerlink" title="CocoaPods"></a>CocoaPods</h1><p>#</p>
<h1 id="We-recommend-against-adding-the-Pods-directory-to-your-gitignore-However"><a href="#We-recommend-against-adding-the-Pods-directory-to-your-gitignore-However" class="headerlink" title="We recommend against adding the Pods directory to your .gitignore. However"></a>We recommend against adding the Pods directory to your .gitignore. However</h1><h1 id="you-should-judge-for-yourself-the-pros-and-cons-are-mentioned-at"><a href="#you-should-judge-for-yourself-the-pros-and-cons-are-mentioned-at" class="headerlink" title="you should judge for yourself, the pros and cons are mentioned at:"></a>you should judge for yourself, the pros and cons are mentioned at:</h1><h1 id="http-guides-cocoapods-org-using-using-cocoapods-html-should-i-ignore-the-pods-directory-in-source-control"><a href="#http-guides-cocoapods-org-using-using-cocoapods-html-should-i-ignore-the-pods-directory-in-source-control" class="headerlink" title="http://guides.cocoapods.org/using/using-cocoapods.html#should-i-ignore-the-pods-directory-in-source-control"></a><a href="http://guides.cocoapods.org/using/using-cocoapods.html#should-i-ignore-the-pods-directory-in-source-control" target="_blank" rel="external">http://guides.cocoapods.org/using/using-cocoapods.html#should-i-ignore-the-pods-directory-in-source-control</a></h1><p>#</p>
<h1 id="Pods-“-gt-gitignore"><a href="#Pods-“-gt-gitignore" class="headerlink" title="Pods/“ &gt; .gitignore"></a>Pods/“ &gt; .gitignore</h1><hr>
<h1 id="将-gitignore添加到代码库"><a href="#将-gitignore添加到代码库" class="headerlink" title="将.gitignore添加到代码库"></a>将.gitignore添加到代码库</h1><p>$ git add .gitignore</p>
<h1 id="03-创建项目"><a href="#03-创建项目" class="headerlink" title="03. 创建项目"></a>03. 创建项目</h1><p>提交同时”push”到远程代码仓库</p>
<h1 id="04-新人加入"><a href="#04-新人加入" class="headerlink" title="04. 新人加入"></a>04. 新人加入</h1><p>…</p>
<h1 id="05-分布式的代码库-仅供参考"><a href="#05-分布式的代码库-仅供参考" class="headerlink" title="05. 分布式的代码库 - 仅供参考"></a>05. 分布式的代码库 - 仅供参考</h1><p>由于git是分布式的，任何一台计算机上都保留有完整的代码库的内容，因此可以把团队开发的代码库放在任何位置</p>
<p>多个远程代码库之间的同步演练”提示，此演练仅供了解，具体的使用，需要一定的团队规模之后，才能够体会”</p>
<h1 id="06-分支管理-Tag"><a href="#06-分支管理-Tag" class="headerlink" title="06. 分支管理 - Tag"></a>06. 分支管理 - Tag</h1><h1 id="查看当前标签"><a href="#查看当前标签" class="headerlink" title="查看当前标签"></a>查看当前标签</h1><p>$ git tag</p>
<h1 id="在本地代码库给项目打上一个标签"><a href="#在本地代码库给项目打上一个标签" class="headerlink" title="在本地代码库给项目打上一个标签"></a>在本地代码库给项目打上一个标签</h1><p>$ git tag -a v1.0 -m ‘Version 1.0’</p>
<h1 id="将标签添推送到远程代码库中"><a href="#将标签添推送到远程代码库中" class="headerlink" title="将标签添推送到远程代码库中"></a>将标签添推送到远程代码库中</h1><p>$ git push origin v1.0</p>
<h1 id="使用tag，就能够将项目快速切换到某一个中间状态，例如产品开发线上的某一个稳定版本"><a href="#使用tag，就能够将项目快速切换到某一个中间状态，例如产品开发线上的某一个稳定版本" class="headerlink" title="使用tag，就能够将项目快速切换到某一个中间状态，例如产品开发线上的某一个稳定版本"></a>使用tag，就能够将项目快速切换到某一个中间状态，例如产品开发线上的某一个稳定版本</h1><h1 id="签出v1-0标签"><a href="#签出v1-0标签" class="headerlink" title="签出v1.0标签"></a>签出v1.0标签</h1><p>$ git checkout v1.0</p>
<h1 id="从签出状态创建v1-0bugfix分支"><a href="#从签出状态创建v1-0bugfix分支" class="headerlink" title="从签出状态创建v1.0bugfix分支"></a>从签出状态创建v1.0bugfix分支</h1><p>$ git checkout -b bugfix1.0</p>
<h1 id="查看远程分支"><a href="#查看远程分支" class="headerlink" title="查看远程分支"></a>查看远程分支</h1><p>$ git branch -r</p>
<h1 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h1><p>$ git branch -r -d origin/bugfix1.0<br></p>
<p>### </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/03/ios-image-loading-speed-limit-optimization/" itemprop="url">
                  iOS图片加载速度极限优化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-03T23:16:32+08:00" content="2015-09-03">
              2015-09-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/IOS/" itemprop="url" rel="index">
                    <span itemprop="name">IOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://github.com/path/FastImageCache" target="_blank" rel="external">FastImageCache</a>是Path团队开发的一个开源库，用于提升图片的加载和渲染速度，让基于图片的列表滑动起来更顺畅，来看看它是怎么做的。</p>
<h1 id="优化点"><a href="#优化点" class="headerlink" title="优化点"></a>优化点</h1><p>iOS从磁盘加载一张图片，使用UIImageVIew显示在屏幕上，需要经过以下步骤：</p>
<ol>
<li>从磁盘拷贝数据到内核缓冲区</li>
<li>从内核缓冲区复制数据到用户空间</li>
<li>生成UIImageView，把图像数据赋值给UIImageView</li>
<li>如果图像数据为未解码的PNG/JPG，解码为位图数据</li>
<li>CATransaction捕获到UIImageView layer树的变化</li>
<li><p>主线程Runloop提交CATransaction，开始进行图像渲染</p>
<ul>
<li>6.1 如果数据没有字节对齐，Core Animation会再拷贝一份数据，进行字节对齐。</li>
<li>6.2 GPU处理位图数据，进行渲染。<br>FastImageCache分别优化了2,4,6.1三个步骤：</li>
</ul>
</li>
<li><p>使用mmap内存映射，省去了上述第2步数据从内核空间拷贝到用户空间的操作。</p>
</li>
<li>缓存解码后的位图数据到磁盘，下次从磁盘读取时省去第4步解码的操作。</li>
<li>生成字节对齐的数据，防止上述第6.1步CoreAnimation在渲染时再拷贝一份数据。<br>接下来具体介绍这三个优化点以及它的实现。</li>
</ol>
<h3 id="内存映射"><a href="#内存映射" class="headerlink" title="内存映射"></a>内存映射</h3><p>平常我们读取磁盘上的一个文件，上层API调用到最后会使用系统方法read()读取数据，内核把磁盘数据读入内核缓冲区，用户再从内核缓冲区读取数据复制到用户内存空间，这里有一次内存拷贝的时间消耗，并且读取后整个文件数据就已经存在于用户内存中，占用了进程的内存空间。</p>
<p>FastImageCache采用了另一种读写文件的方法，就是用mmap把文件映射到用户空间里的虚拟内存，文件中的位置在虚拟内存中有了对应的地址，可以像操作内存一样操作这个文件，相当于已经把整个文件放入内存，但在真正使用到这些数据前却不会消耗物理内存，也不会有读写磁盘的操作，只有真正使用这些数据时，也就是图像准备渲染在屏幕上时，虚拟内存管理系统VMS才根据缺页加载的机制从磁盘加载对应的数据块到物理内存，再进行渲染。这样的文件读写文件方式少了数据从内核缓存到用户空间的拷贝，效率很高。</p>
<h3 id="解码图像"><a href="#解码图像" class="headerlink" title="解码图像"></a>解码图像</h3><p>一般我们使用的图像是JPG/PNG，这些图像数据不是位图，而是是经过编码压缩后的数据，使用它渲染到屏幕之前需要进行解码转成位图数据，这个解码操作是比较耗时的，并且没有GPU硬解码，只能通过CPU，iOS默认会在主线程对图像进行解码。很多库都解决了图像解码的问题，不过由于解码后的图像太大，一般不会缓存到磁盘，SDWebImage的做法是把解码操作从主线程移到子线程，让耗时的解码操作不占用主线程的时间。</p>
<p>FastImageCache也是在子线程解码图像，不同的是它会缓存解码后的图像到磁盘。因为解码后的图像体积很大，FastImageCache对这些图像数据做了系列缓存管理，详见下文实现部分。另外缓存的图像体积大也是使用内存映射读取文件的原因，小文件使用内存映射无优势，内存拷贝的量少，拷贝后占用用户内存也不高，文件越大内存映射优势越大。</p>
<h3 id="字节对齐"><a href="#字节对齐" class="headerlink" title="字节对齐"></a>字节对齐</h3><p>Core Animation在图像数据非字节对齐的情况下渲染前会先拷贝一份图像数据，官方文档没有对这次拷贝行为作说明，模拟器和Instrument里有高亮显示“copied images”的功能，但似乎它有bug，即使某张图片没有被高亮显示出渲染时被copy，从调用堆栈上也还是能看到调用了CA::Render::copy_image方法：</p>
<p><a href="http://blog.cnbang.net/wp-content/uploads/2015/02/fastImageCache1.png" target="_blank" rel="external"><img src="http://blog.cnbang.net/wp-content/uploads/2015/02/fastImageCache1.png" alt="fastImageCache1"></a></p>
<p>那什么是字节对齐呢，按我的理解，为了性能，底层渲染图像时不是一个像素一个像素渲染，而是一块一块渲染，数据是一块块地取，就可能遇到这一块连续的内存数据里结尾的数据不是图像的内容，是内存里其他的数据，可能越界读取导致一些奇怪的东西混入，所以在渲染之前CoreAnimation要把数据拷贝一份进行处理，确保每一块都是图像数据，对于不足一块的数据置空。大致图示：(pixel是图像像素数据，data是内存里其他数据)</p>
<p><a href="http://blog.cnbang.net/wp-content/uploads/2015/02/fastImageCache2.png" target="_blank" rel="external"><img src="http://blog.cnbang.net/wp-content/uploads/2015/02/fastImageCache2.png" alt="fastImageCache2"></a></p>
<p>块的大小应该是跟CPU cache line有关，ARMv7是32byte，A9是64byte，在A9下CoreAnimation应该是按64byte作为一块数据去读取和渲染，让图像数据对齐64byte就可以避免CoreAnimation再拷贝一份数据进行修补。FastImageCache做的字节对齐就是这个事情。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>FastImageCache把同个类型和尺寸的图像都放在一个文件里，根据文件偏移取单张图片，类似web的css雪碧图，这里称为ImageTable。这样做主要是为了方便统一管理图片缓存，控制缓存的大小，整个FastImageCache就是在管理一个个ImageTable的数据。整体实现的数据结构如图：</p>
<p><a href="http://blog.cnbang.net/wp-content/uploads/2015/02/fastImageCache3.png" target="_blank" rel="external"><img src="http://blog.cnbang.net/wp-content/uploads/2015/02/fastImageCache3.png" alt="fastImageCache3"></a></p>
<p>一些补充和说明：</p>
<h3 id="ImageTable"><a href="#ImageTable" class="headerlink" title="ImageTable"></a>ImageTable</h3><ol>
<li>一个ImageFormat对应一个ImageTable，ImageFormat指定了ImageTable里图像渲染格式/大小等信息，ImageTable里的图像数据都由ImageFormat规定了统一的尺寸，每张图像大小都是一样的。</li>
<li>一个ImageTable一个实体文件，并有另一个文件保存这个ImageTable的meta信息。</li>
<li>图像使用entityUUID作为唯一标示符，由用户定义，通常是图像url的hash值。ImageTable Meta的indexMap记录了entityUUID-&gt;entryIndex的映射，通过indexMap就可以用图像的entityUUID找到缓存数据在ImageTable对应的位置。</li>
</ol>
<h3 id="ImageTableEntry"><a href="#ImageTableEntry" class="headerlink" title="ImageTableEntry"></a>ImageTableEntry</h3><ol>
<li>ImageTable的实体数据是ImageTableEntry，每个entry有两部分数据，一部分是对齐后的图像数据，另一部分是meta信息，meta保存这张图像的UUID和原图UUID，用于校验图像数据的正确性。</li>
<li>Entry数据是按内存分页大小对齐的，数据大小是内存分页大小的整数倍，这样可以保证虚拟内存缺页加载时使用最少的内存页加载一张图像。</li>
<li>图像数据做了字节对齐处理，CoreAnimation使用时无需再处理拷贝。具体做法是CGBitmapContextCreate创建位图画布时bytesPerRow参数传64倍数。</li>
</ol>
<h3 id="Chunk"><a href="#Chunk" class="headerlink" title="Chunk"></a>Chunk</h3><ul>
<li>ImageTable和实体数据Entry间多了层Chunk，Chunk是逻辑上的数据划分，N个Entry作为一个Chunk，内存映射mmap操作是以chunk为单位的，每一个chunk执行一次mmap把这个chunk的内容映射到虚拟内存。为什么要多一层chunk呢，按我的理解，这样做是为了灵活控制mmap的大小和调用次数，若对整个ImageTable执行mmap，载入虚拟内存的文件过大，若对每个Entry做mmap，调用次数会太多。</li>
</ul>
<h3 id="缓存管理"><a href="#缓存管理" class="headerlink" title="缓存管理"></a>缓存管理</h3><ul>
<li>用户可以定义整个ImageTable里最大缓存的图像数量，在有新图像需要缓存时，如果缓存没有超过限制，会以chunk为单位扩展文件大小，顺序写下去。如果已超过最大缓存限制，会把最少使用的缓存替换掉，实现方法是每次使用图像都会把UUID插入到MRUEntries数组的开头，MRUEntries按最近使用顺序排列了图像UUID，数组里最后一个图像就是最少使用的。被替换掉的图片下次需要再使用时，再走一次取原图—解压—存储的流程。</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>FastImageCache适合用于tableView里缓存每个cell上同样规格的图像，优点是能极大加快第一次从磁盘加载这些图像的速度。但它有两个明显的缺点：一是占空间大。因为缓存了解码后的位图到磁盘，位图是很大的，宽高100<em>100的图像在2x的高清屏设备下就需要200</em>200*4byte/pixel=156KB，这也是为什么FastImageCache要大费周章限制缓存大小。二是接口不友好，需预定义好缓存的图像尺寸。FastImageCache无法像SDWebImage那样无缝接入UIImageView，使用它需要配置ImageTable，定义好尺寸，手动提供的原图，每种实体图像要定义一个FICEntity模型，使逻辑变复杂。</p>
<p>FastImageCache已经属于极限优化，做图像加载/渲染优化时应该优先考虑一些低代价高回报的优化点，例如CALayer代替UIImageVIew，减少GPU计算（去透明/像素对齐），图像子线程解码，避免Offscreen-Render等。在其他优化都做到位，图像的渲染还是有性能问题的前提下才考虑使用FastImageCache进一步提升首次加载的性能，不过字节对齐的优化倒是可以脱离FastImageCache直接运用在项目上，只需要在解码图像时bitmap画布的bytesPerRow设为64的倍数即可。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/09/03/uiview-contentmode/" itemprop="url">
                  UIView 的contentMode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-09-03T22:17:43+08:00" content="2015-09-03">
              2015-09-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OC/UI/" itemprop="url" rel="index">
                    <span itemprop="name">UI</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="内容模式"><a href="#内容模式" class="headerlink" title="内容模式"></a><strong>内容模式</strong></h2><p>　　一个视图向它自身绘图，相对于只有背景颜色和子视图，它还有内容。这意味着每当视图被调整大小它的<strong>contentMode</strong>属性就变得非常重要。正如我之前提到的，绘图系统会尽可能避免重头开始绘制视图。相反，绘图系统将使用之前绘图操作的缓存结果（位图回填）。所以，如果视图被重新调整大小，系统可能简单的伸缩或重定位缓存绘图，前提是你的<strong>contentMode</strong>设置指令是是这样设置的。</p>
<p> <wbr></p>
<p>通常我们的视图的<strong>contentMode</strong>属性需要与视图绘制自己的方式一致。假设我们的<strong>drawRect：</strong>方法中的代码让箭头的尺寸和位置相对于视图的边界原点，即它的左上方。所以我们可以设置它的<strong>contentMode</strong>为<strong>UIViewContentModeTopLeft<wbr></strong>。又或者，我们可以将<strong>contentMode</strong>设置为<strong>UIVIewContentModeRedraw，</strong>这将引起缓存内容的自动缩放和重定位被关闭，最终结果是视图的<strong>setNeedsDisplay</strong>方法将被调用，触发<strong>drawRect：</strong>方法重绘视图内容。</p>
<p>　　在另一方面，如果一个视图只是暂时被调整大小。假设是作为动画的一部分，那么伸缩行为正是你所想要的。假设我们的动画是想要让视图变大然后还原回原始大小以达到作为吸引用户的一种手段。这就需要视图伸缩的时候视图的内容也跟着伸缩，正确的<strong>contentMode</strong>的值是<strong>UIViewContentModeScaleTo<wbr>Fill</strong>，被伸缩的内容仅仅是视图内容的一副缓存图片，所以它运行起来十分的高效。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><pre class="lang:objc decode:true ">        /**<br>         UIViewContentModeScaleToFill : 图片拉伸至填充整个UIImageView（图片可能会变形）</pre></p>
<pre><code>UIViewContentModeScaleAspectFit : 图片拉伸至完全显示在UIImageView里面为止（图片不会变形）

UIViewContentModeScaleAspectFill : 
图片拉伸至 图片的宽度等于UIImageView的宽度 或者 图片的高度等于UIImageView的高度 为止

UIViewContentModeRedraw : 调用了setNeedsDisplay方法时，就会将图片重新渲染

UIViewContentModeCenter : 居中显示
UIViewContentModeTop,
UIViewContentModeBottom,
UIViewContentModeLeft,
UIViewContentModeRight,
UIViewContentModeTopLeft,
UIViewContentModeTopRight,
UIViewContentModeBottomLeft,
UIViewContentModeBottomRight,

经验规律：
1.凡是带有Scale单词的，图片都会拉伸
2.凡是带有Aspect单词的，图片都会保持原来的宽高比，图片不会变形
*/&lt;/pre&gt;
</code></pre><p>&nbsp;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/27/kvc-and-kvo-comprehension/" itemprop="url">
                  KVC 与 KVO 理解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-08-27T00:32:09+08:00" content="2015-08-27">
              2015-08-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>KVC 与 KVO 是 Objective C 的关键概念，个人认为必须理解的东西，下面是实例讲解。</p>
<p>Key-Value Coding (KVC)<br>KVC，即是指 NSKeyValueCoding，一个非正式的 Protocol，提供一种机制来间接访问对象的属性。KVO 就是基于 KVC 实现的关键技术之一。</p>
<p>一个对象拥有某些属性。比如说，一个 Person 对象有一个 name 和一个 address 属性。以 KVC 说法，Person 对象分别有一个 value 对应他的 name 和 address 的 key。 key 只是一个字符串，它对应的值可以是任意类型的对象。从最基础的层次上看，KVC 有两个方法：一个是设置 key 的值，另一个是获取 key 的值。如下面的例子：</p>
<p><pre class="lang:objc decode:true ">void changeName(Person <em>p, NSString </em>newName)<br>{</pre></p>
<pre><code>// using the KVC accessor (getter) method
NSString *originalName = [p valueForKey:@&quot;name&quot;];

// using the KVC  accessor (setter) method.
[p setValue:newName forKey:@&quot;name&quot;];

NSLog(@&quot;Changed %@&apos;s name to: %@&quot;, originalName, newName);
</code></pre><p>}<br>&nbsp;</p>
<p>现在，如果 Person 有另外一个 key 配偶（spouse），spouse 的 key 值是另一个 Person 对象，用 KVC 可以这样写：</p>
<p><pre class="lang:objc decode:true">void logMarriage(Person *p)<br>{</pre></p>
<pre><code>// just using the accessor again, same as example above
NSString *personsName = [p valueForKey:@&quot;name&quot;];

// this line is different, because it is using
// a &quot;key path&quot; instead of a normal &quot;key&quot;
NSString *spousesName = [p valueForKeyPath:@&quot;spouse.name&quot;];

NSLog(@&quot;%@ is happily married to %@&quot;, personsName, spousesName);
</code></pre><p>}<br>key 与 key pat 要区分开来，key 可以从一个对象中获取值，而 key path 可以将多个 key 用点号 “.” 分割连接起来，比如：</p>
<p>[p valueForKeyPath:@”spouse.name”];<br>相当于这样……</p>
<p>[[p valueForKey:@”spouse”] valueForKey:@”name”];<br>好了，以上是 KVC 的基本知识，接着看看 KVO。</p>
<p>Key-Value Observing (KVO)<br>Key-Value Observing (KVO) 建立在 KVC 之上，它能够观察一个对象的 KVC key path 值的变化。举个例子，用代码观察一个 person 对象的 address 变化，以下是实现的三个方法：</p>
<p>watchPersonForChangeOfAddress: 实现观察<br>observeValueForKeyPath:ofObject:change:context: 在被观察的 key path 的值变化时调用。<br>dealloc 停止观察</p>
<p><pre class="lang:objc decode:true">static NSString *const KVO_CONTEXT_ADDRESS_CHANGED = @”KVO_CONTEXT_ADDRESS_CHANGED”</pre></p>
<p>@implementation PersonWatcher</p>
<p>-(void) watchPersonForChangeOfAddress:(Person *)p<br>{</p>
<p>// this begins the observing<br>[p addObserver:self<br>forKeyPath:@”address”<br>options:0<br>context:KVO_CONTEXT_ADDRESS_CHANGED];</p>
<p>// keep a record of all the people being observed,<br>// because we need to stop observing them in dealloc<br>[m_observedPeople addObject:p];<br>}</p>
<p>// whenever an observed key path changes, this method will be called</p>
<ul>
<li>(void)observeValueForKeyPath:(NSString <em>)keyPath<br>ofObject:(id)object<br>change:(NSDictionary </em>)change<br>context:(void *)context</li>
</ul>
<p>{<br>// use the context to make sure this is a change in the address,<br>// because we may also be observing other things<br>if(context == KVO_CONTEXT_ADDRESS_CHANGED) {<br>NSString <em>name = [object valueForKey:@”name”];<br>NSString </em>address = [object valueForKey:@”address”];<br>NSLog(@”%@ has a new address: %@”, name, address);<br>}<br>}</p>
<p>-(void) dealloc;<br>{</p>
<p>// must stop observing everything before this object is<br>// deallocated, otherwise it will cause crashes<br>for(Person *p in m_observedPeople){<br>[p removeObserver:self forKeyPath:@”address”];<br>}</p>
<p>[m_observedPeople release];<br>m_observedPeople = nil;</p>
<p>[super dealloc];</p>
<p>}</p>
<p>-(id) init;<br>{<br>if(self = [super init]){<br>m_observedPeople = [NSMutableArray new];<br>}</p>
<p>return self;<br>}</p>
<p>@end<br>这就是 KVO 的作用，它通过 key path 观察对象的值，当值发生变化的时候会收到通知。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="BirdMichael" />
          <p class="site-author-name" itemprop="name">BirdMichael</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">59</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">80</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BirdMichael</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
