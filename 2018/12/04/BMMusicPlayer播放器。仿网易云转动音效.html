<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="BMMusicPlayer简介基于FreeStreamer播放器二次封装。仿网易云封面图旋转，转圈音乐动效。全局基于ASDK。 里面有几个算是技术点吧，分别为：  仿’爱奇艺’Tabbar点击动画切换效果 list页面cell采用ASDK实现layer化 播放器单利实现，除”关闭”，”进度条滑块”采用ASDK实现layer化。 播放器背景使用封面图背景高斯模糊效果，获取图片主色调作为shando">
<meta property="og:type" content="article">
<meta property="og:title" content="BMMusicPlayer播放器。仿网易云转动音效">
<meta property="og:url" content="http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html">
<meta property="og:site_name" content="BirdMichael">
<meta property="og:description" content="BMMusicPlayer简介基于FreeStreamer播放器二次封装。仿网易云封面图旋转，转圈音乐动效。全局基于ASDK。 里面有几个算是技术点吧，分别为：  仿’爱奇艺’Tabbar点击动画切换效果 list页面cell采用ASDK实现layer化 播放器单利实现，除”关闭”，”进度条滑块”采用ASDK实现layer化。 播放器背景使用封面图背景高斯模糊效果，获取图片主色调作为shando">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.com/birdmichael/MultiAudio/raw/master/logo.jpg">
<meta property="og:image" content="https://github.com/birdmichael/BMMusicPlayer/raw/master/2.gif">
<meta property="og:updated_time" content="2018-12-04T11:20:21.267Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BMMusicPlayer播放器。仿网易云转动音效">
<meta name="twitter:description" content="BMMusicPlayer简介基于FreeStreamer播放器二次封装。仿网易云封面图旋转，转圈音乐动效。全局基于ASDK。 里面有几个算是技术点吧，分别为：  仿’爱奇艺’Tabbar点击动画切换效果 list页面cell采用ASDK实现layer化 播放器单利实现，除”关闭”，”进度条滑块”采用ASDK实现layer化。 播放器背景使用封面图背景高斯模糊效果，获取图片主色调作为shando">
<meta name="twitter:image" content="https://github.com/birdmichael/MultiAudio/raw/master/logo.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>BMMusicPlayer播放器。仿网易云转动音效</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/12/05/iproxy-通过USB使用SSH连接iOS设备.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/02/22/Python错误调试及IO编程.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href=/ ><i class="fa fa-home" aria-hidden="true" onmouseover="$('#i-home').toggle();" onmouseout="$('#i-home').toggle();"></i></a></li>
      </ul>
      <span id="i-home" class="info" style="display:none;">首 页</span>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&text=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&is_video=false&description=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BMMusicPlayer播放器。仿网易云转动音效&body=Check out this article: http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&name=BMMusicPlayer播放器。仿网易云转动音效&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BMMusicPlayer简介"><span class="toc-number">1.</span> <span class="toc-text">BMMusicPlayer简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#仿”爱奇艺”Tabbar的点击切换效果。"><span class="toc-number">1.1.</span> <span class="toc-text">仿”爱奇艺”Tabbar的点击切换效果。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASDK"><span class="toc-number">1.2.</span> <span class="toc-text">ASDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#播放器动画"><span class="toc-number">1.3.</span> <span class="toc-text">播放器动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#截图演示-声音播放部分无法演示"><span class="toc-number">1.4.</span> <span class="toc-text">截图演示(声音播放部分无法演示)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主代码说明"><span class="toc-number">1.5.</span> <span class="toc-text">主代码说明</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        BMMusicPlayer播放器。仿网易云转动音效
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">BirdMichael</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-12-04T10:22:22.000Z" itemprop="datePublished">2018-12-04</time>
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><a href="https://github.com/birdmichael/MultiAudio/blob/master/logo.jpg" target="_blank" rel="noopener"><img src="https://github.com/birdmichael/MultiAudio/raw/master/logo.jpg" alt="logo"></a></p>
<h1 id="BMMusicPlayer简介"><a href="#BMMusicPlayer简介" class="headerlink" title="BMMusicPlayer简介"></a>BMMusicPlayer简介</h1><p>基于FreeStreamer播放器二次封装。仿网易云封面图旋转，转圈音乐动效。全局基于ASDK。</p>
<p>里面有几个算是技术点吧，分别为：</p>
<ul>
<li>仿’爱奇艺’Tabbar点击动画切换效果</li>
<li>list页面cell采用ASDK实现layer化</li>
<li>播放器单利实现，除”关闭”，”进度条滑块”采用ASDK实现layer化。</li>
<li>播放器背景使用封面图背景高斯模糊效果，获取图片主色调作为shandow。音效动画同样获取图片主色调。</li>
</ul>
<p>现在来分别的来详细说说</p>
<h2 id="仿”爱奇艺”Tabbar的点击切换效果。"><a href="#仿”爱奇艺”Tabbar的点击切换效果。" class="headerlink" title="仿”爱奇艺”Tabbar的点击切换效果。"></a>仿”爱奇艺”Tabbar的点击切换效果。</h2><p>之前一直觉得爱奇艺的动画做的好屌~很多动画单纯用代码实现，仅一个路径就要画死人。并且很多app的小控件做的都很厉害。你可以看看很多主流的播放器的播放暂停按钮，那个动画简直让人不知道如何用纯代码实现。在羡慕的同时就发现一个很有意思的库:<code>lottie</code>。这个是<a href="https://github.com/airbnb" target="_blank" rel="noopener">airbnb</a>开源的一个动画库，当然现在已经很普及了。它是通过设计师设计或者网上下载一些素材通过<a href="http://www.adobe.com/products/aftereffects.html" target="_blank" rel="noopener">Adobe After Effects</a>配合对应的外挂扩展插件到处一个json。然后再项目带入对应的库，调用json来实现动画效果。</p>
<p>整体体验下来效果还是不错的。而且过程也很简单。但是有一个痛点是灵活性不足—不方便于修改。一般来说都是设计师做好了整个成品（注意：里面可能还设计尺寸匹配），然后生成json，各端导入。而json文件为了大小，可读性基本为0。那么就带来了另外一个问题。几乎不可以二次修改。</p>
<p>有一个官方的素材库：<a href="https://www.lottiefiles.com/" target="_blank" rel="noopener">https://www.lottiefiles.com/</a> 里面的动画真的厉害的不行。但是基于第二点问题。里面真正开源，也就是带有<code>AEP</code>资源的其实很少。而一般来说这种动画都需要做一点程度的定制化，也就导致真正可用的其实不多。</p>
<p>不过~如果您公司有一个牛逼的设计师。用这个库还是超级爽歪歪的。</p>
<h2 id="ASDK"><a href="#ASDK" class="headerlink" title="ASDK"></a>ASDK</h2><p>ASDK也就是<code>FaceBook</code>开源的非常出名的<code>AsyncDisplayKit</code>,但已经改名为<code>Texture</code>。</p>
<p>最早知道这个库是在研究<code>YYKit</code>时，作者提到很多核心渲染逻辑是借鉴的它。具体有多调，网上随便搜索一下就知道了。之前一直没有机会接触到，刚好有一个新项目，就用80%的<code>ASDK</code>写了。</p>
<p>基本上重新封装了整个<code>UIKit</code>，大到控制器，小到<code>Label</code>。主要说一说使用感受。</p>
<p>异步控制：之前一直觉得既然是异步渲染，那么在写业务代码的时候是有多繁琐啊。使用下来发现其实还好。正常的<code>View</code>里面的线程处理问题不会特别复杂，我也没遇到什么大的问题。主要遇到的问题都在动画上。</p>
<p><code>View</code>与<code>Layer</code>选择：这个库很吊的是，很多空间都可以直接使用<code>Layer</code>来绘制。比如播放器的List页面，里面的封面图，new整个视图，锁整个视图，标题，时间都是在一个层级。但是带来一个弊端是：调式有点傻~ 需要一个一个把<code>isLayerBacked</code>关掉。</p>
<p>布局：首先<code>ASDK</code>是不支持<code>AutoLayout</code>的，引入了新的布局方式<code>Flex</code>。要么你不想有成本就傻傻的用frame布局。但是这明显不是一个正确的选择。说说<code>Flex</code>的学习成本吧，大概就是一天。然后你会发现这种布局方式太爽，太灵活，太兼容性强了。而且代码量也不是特别多。只是刚开始的时候有点不习惯。它的思路永远是从最小控件然后一点一点成Spec到最大。</p>
<p>缺点：学习成本，而且目前的2.7版本也不是一个很稳定版本（截稿位置，最近的commit是1天以前）。第三方的问题。正常的开发其实对第三方的依赖性很强的，而它不是特别的友好。动画问题，不知道这个是不是我个人的原因，总觉得怪怪的。而且因为异步的原因还有闪烁的问题，一直也没有很好的解决办法。</p>
<p>最后，给一点我的个人建议。排除这个库的体积来说，我觉得这个库还是值得引入的。但是已最小模块来使用。也就是说简单的没有交互的简单页面或者控件，小到VIew来用。你可以这样理解 就把他当做是一个可变图片处理器。可以动态绘制出你需要的图。放在对应的View上。或者。。。<code>YYkit</code></p>
<h2 id="播放器动画"><a href="#播放器动画" class="headerlink" title="播放器动画"></a>播放器动画</h2><p>播放器动画其实拆2个，一个是最简单的基础动画，旋转。一个是多条圈的波纹动画。波纹动画上还有一个小圆点，从几个地方旋转出来。</p>
<p>核心思想其实就是把小圆点放在 圈让，然后让圈也旋转。然后通过动画<code>beginTime</code>参数来控制波纹的效果，简单理解就是每个延时一点产生的视觉效果。</p>
<p>眨眼一看波纹动画的代码量好多。我也很觉得在demo使用<code>UIKit</code>的时候其实代码了很少的，只是在<code>ASDK</code>也不知道为什么我用动画组的时候只能执行一个动画。也是排查了很久才找到这个问题。于是需要给每一个动画设置重复的属性。</p>
<p>还有一个点是在圆角上的<code>Shadow</code>，也不算什么难点吧，但是可以提一下，就是分为2块，一块是是作为<code>Shadow</code>，一块作为圆角的裁剪</p>
<p><code>iOSPalette</code>一个开源的提取一张图片的主色调。使得页面更加的生活灵活，不同的封面图下有不同的光晕和波纹动画，效果十分的赞。算法是<code>Google</code>拔下来。具体看看作者简书就好了，我这里也不过多介绍了。</p>
<h2 id="截图演示-声音播放部分无法演示"><a href="#截图演示-声音播放部分无法演示" class="headerlink" title="截图演示(声音播放部分无法演示)"></a>截图演示(声音播放部分无法演示)</h2><p><a href="https://github.com/birdmichael/BMMusicPlayer/blob/master/2.gif" target="_blank" rel="noopener"><img src="https://github.com/birdmichael/BMMusicPlayer/raw/master/2.gif" alt="img"></a></p>
<h2 id="主代码说明"><a href="#主代码说明" class="headerlink" title="主代码说明"></a>主代码说明</h2><p>1.Tabbar部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">BMTabBarController.m</span><br><span class="line">- (void)tabBar:(UITabBar *)tabBar didSelectItem:(UITabBarItem *)item&#123;</span><br><span class="line">    NSArray * sss = self.tabBar.subviews;</span><br><span class="line">    NSMutableArray *tabbatButtonArray = [@[] mutableCopy];</span><br><span class="line">    for (UIView *view in sss) &#123;</span><br><span class="line">        if ([view isKindOfClass:NSClassFromString(@&quot;UITabBarButton&quot;)]) &#123;</span><br><span class="line">            [tabbatButtonArray addObject:view];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for (UIView *view in [tabbatButtonArray[item.tag] subviews]) &#123;</span><br><span class="line">        if ([view isKindOfClass:NSClassFromString(@&quot;UITabBarSwappableImageView&quot;)]) &#123;</span><br><span class="line">            [self.animation removeFromSuperview];</span><br><span class="line">            NSString * name = item.title;</span><br><span class="line">            LOTAnimationView *animation = [LOTAnimationView animationNamed:name];</span><br><span class="line">            [view addSubview:animation];</span><br><span class="line">            animation.bounds = CGRectMake(0, 0,view.bounds.size.width,view.bounds.size.width);</span><br><span class="line">            animation.center = CGPointMake(view.bounds.size.width/2, view.bounds.size.height/2);</span><br><span class="line">            [animation playWithCompletion:^(BOOL animationFinished) &#123;</span><br><span class="line">                // Do Something</span><br><span class="line">            &#125;];</span><br><span class="line">            self.animation = animation;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用同一个<code>animation</code>来播放动画，通过移除添加控制生命周期。</p>
<p>2.播放器页面高斯模糊，shandow，音效动画</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BMMusicDisplayNode.m</span><br></pre></td></tr></table></figure>
<ul>
<li>高斯模糊</li>
</ul>
<p>因为使用asdk异步线程，告诉模糊放在了图片的归解档中。正常在主线程拿到下载后的图片中操作就好了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_imageBackGroudNode.imageModificationBlock = ^UIImage * _Nullable(UIImage * _Nonnull image) &#123;</span><br><span class="line">        // GPUimage</span><br><span class="line">        GPUImageGaussianBlurFilter *filter = [[GPUImageGaussianBlurFilter alloc] init];</span><br><span class="line">        filter.blurRadiusInPixels = 40.0;</span><br><span class="line">        [filter forceProcessingAtSize:image.size];</span><br><span class="line">        GPUImagePicture *pic = [[GPUImagePicture alloc] initWithImage:image];</span><br><span class="line">        [pic addTarget:filter];</span><br><span class="line">        [pic processImage];</span><br><span class="line">        [filter useNextFrameForImageCapture];</span><br><span class="line">        return [filter imageFromCurrentFramebuffer];</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>获取主色作为shandow</p>
<p>1。因为是圆角添加shandow，涉及<code>masksToBounds</code>所以是在<code>coverPictureNode</code>背后有一个同样大小的<code>coverPictureShadowNode</code>上添加的shandow。</p>
<p>2。使用<code>#import &quot;iOSPalette.h&quot;</code>在<code>- (**void**)getPaletteImageColor:(GetColorBlock)block;</code>中获取主颜色，并设置给<code>coverPictureShadowNode</code>。同时这个时候把颜色给音效动画。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">_coverPictureNode.imageModificationBlock = ^UIImage * _Nullable(UIImage * _Nonnull image) &#123;</span><br><span class="line">        dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">            [image getPaletteImageColor:^(PaletteColorModel *recommendColor, NSDictionary *allModeColorDic, NSError *error) &#123;</span><br><span class="line">                dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                    weakSelf.coverPictureShadowNode.layer.shadowColor = [UIColor bm_colorWithHexString:recommendColor.imageColorString].CGColor;</span><br><span class="line">                    weakSelf.coverPictureShadowNode.layer.shadowOffset = CGSizeMake(0,10);</span><br><span class="line">                    weakSelf.coverPictureShadowNode.shadowRadius = 29;</span><br><span class="line">                    weakSelf.coverPictureShadowNode.shadowOpacity = 0.5;</span><br><span class="line">                    </span><br><span class="line">                    for (CALayer *layer in weakSelf.rippleArray) &#123;</span><br><span class="line">                        layer.borderColor = [UIColor bm_colorWithHexString:recommendColor.imageColorString].CGColor;</span><br><span class="line">                    &#125;</span><br><span class="line">                    for (CALayer *layer in weakSelf.rippleCircleArray) &#123;</span><br><span class="line">                        layer.backgroundColor = [UIColor bm_colorWithHexString:recommendColor.imageColorString].CGColor;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;);</span><br><span class="line">        CGRect circleRect = (CGRect) &#123;CGPointZero, CGSizeMake(image.size.width, image.size.height)&#125;;</span><br><span class="line">        UIGraphicsBeginImageContextWithOptions(circleRect.size, NO, 0);</span><br><span class="line">        UIBezierPath *circle = [UIBezierPath bezierPathWithRoundedRect:circleRect cornerRadius:circleRect.size.width/2];</span><br><span class="line">        [circle addClip];</span><br><span class="line">        [[UIColor whiteColor] set];</span><br><span class="line">        [circle fill];</span><br><span class="line">        [image drawInRect:circleRect];</span><br><span class="line">        UIImage *roundedImage = UIGraphicsGetImageFromCurrentImageContext();</span><br><span class="line">        UIGraphicsEndImageContext();</span><br><span class="line">        return roundedImage;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>音效动画</li>
</ul>
<p>音效动画分为2个小模块：1.旋转。2.波纹</p>
<p>旋转部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)addAnimation &#123;</span><br><span class="line">    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;transform.rotation.z&quot;];</span><br><span class="line">    animation.duration = 15;</span><br><span class="line">    animation.repeatCount = MAXFLOAT;</span><br><span class="line">    animation.removedOnCompletion = NO;</span><br><span class="line">    animation.toValue = @(M_PI*2);</span><br><span class="line">    [self.coverPictureNode.layer addAnimation:animation forKey:@&quot;rotationAnimation&quot;];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>波纹部分：</p>
<p>​    在波纹地方有其实就是有<code>kCoverPictureRippleCount</code>条圈通过不同的<code>beginTime</code>实现。在asdk中有一个小问题是当使用动画组的时候，仅显示第一个动画，还没找到原因。当使用正常View时，通过设置动画组，并删除动画相同属性就好了，这样代码也精简很多。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">- (void)addRippleAnimation &#123;</span><br><span class="line">    self.rippleArray = [@[] mutableCopy];</span><br><span class="line">    self.rippleCircleArray = [@[] mutableCopy];</span><br><span class="line">    CALayer * animationLayer = [CALayer layer];</span><br><span class="line">    CGFloat maxRadius = kBMSCREEN_WIDTH /2;</span><br><span class="line">    for (int i = 0; i&lt;kCoverPictureRippleCount; i++) &#123;</span><br><span class="line">        CALayer * pulsingLayer = [CALayer layer];</span><br><span class="line">        pulsingLayer.frame = CGRectMake(0, 0, maxRadius*2, maxRadius*2);</span><br><span class="line">        pulsingLayer.position = CGPointMake(BM_FitW(kCoverPictureHW)/2, BM_FitW(kCoverPictureHW)/2);</span><br><span class="line">        pulsingLayer.backgroundColor = [UIColor clearColor].CGColor;</span><br><span class="line">        pulsingLayer.cornerRadius = maxRadius;</span><br><span class="line">        pulsingLayer.borderWidth = kCoverPictureRippleMaxBorderWidth;</span><br><span class="line">        </span><br><span class="line">        CALayer *lay = [CALayer layer];</span><br><span class="line">        lay.frame = CGRectMake(0, 0, kCoverPictureRippleCircleSize, kCoverPictureRippleCircleSize);</span><br><span class="line">        lay.cornerRadius = kCoverPictureRippleCircleSize/2;</span><br><span class="line">        lay.masksToBounds = YES;</span><br><span class="line">        lay.position = CGPointMake(maxRadius*2 * sin(45), maxRadius*2 * sin(45));</span><br><span class="line">        [pulsingLayer addSublayer:lay];</span><br><span class="line">        </span><br><span class="line">        CAMediaTimingFunction * defaultCurve = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionDefault];</span><br><span class="line">        </span><br><span class="line">        CAAnimationGroup * animationGroup = [CAAnimationGroup animation];</span><br><span class="line">        animationGroup.fillMode = kCAFillModeBackwards;</span><br><span class="line">        animationGroup.beginTime = CACurrentMediaTime() + i * kCoverPictureRippleDuration / kCoverPictureRippleCount;</span><br><span class="line">        animationGroup.duration = kCoverPictureRippleDuration;</span><br><span class="line">        animationGroup.repeatCount = HUGE;</span><br><span class="line">        animationGroup.timingFunction = defaultCurve;</span><br><span class="line">        </span><br><span class="line">        CABasicAnimation * scaleAnimation = [CABasicAnimation animationWithKeyPath:@&quot;transform.scale&quot;];</span><br><span class="line">        scaleAnimation.fromValue = @(BM_FitW(kCoverPictureHW)/2 / maxRadius);</span><br><span class="line">        scaleAnimation.toValue = @1.0;</span><br><span class="line">        scaleAnimation.beginTime = CACurrentMediaTime() + i * kCoverPictureRippleDuration / kCoverPictureRippleCount;</span><br><span class="line">        scaleAnimation.fillMode = kCAFillModeBackwards;</span><br><span class="line">        scaleAnimation.timingFunction = defaultCurve;</span><br><span class="line">        scaleAnimation.duration = kCoverPictureRippleDuration;</span><br><span class="line">        scaleAnimation.repeatCount = HUGE;</span><br><span class="line">        scaleAnimation.removedOnCompletion = NO;</span><br><span class="line">        scaleAnimation.fillMode = kCAFillModeForwards;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        CABasicAnimation *animation = [CABasicAnimation new];</span><br><span class="line">        animation.keyPath = @&quot;transform.rotation.z&quot;;</span><br><span class="line">        animation.beginTime = CACurrentMediaTime() + i * kCoverPictureRippleDuration / kCoverPictureRippleCount;</span><br><span class="line">        animation.fromValue = [NSNumber numberWithFloat:i *(M_PI/2)]; // 起始角度</span><br><span class="line">        animation.toValue = [NSNumber numberWithFloat:i *(M_PI/2) + 2*M_PI]; // 终止角度</span><br><span class="line">        animation.duration = 20;</span><br><span class="line">        animation.repeatCount = HUGE;</span><br><span class="line">        animation.timingFunction = defaultCurve;</span><br><span class="line">        animation.removedOnCompletion = NO;</span><br><span class="line">        animation.fillMode = kCAFillModeForwards;</span><br><span class="line">        </span><br><span class="line">        CAKeyframeAnimation * opacityAnimation = [CAKeyframeAnimation animationWithKeyPath:@&quot;opacity&quot;];</span><br><span class="line">        opacityAnimation.beginTime = CACurrentMediaTime() + i * kCoverPictureRippleDuration / kCoverPictureRippleCount;</span><br><span class="line">        opacityAnimation.values = @[@0.3, @0.5, @0];</span><br><span class="line">        opacityAnimation.keyTimes = @[@0, @0.3, @1];</span><br><span class="line">        opacityAnimation.duration = kCoverPictureRippleDuration;</span><br><span class="line">        opacityAnimation.repeatCount = HUGE;</span><br><span class="line">        opacityAnimation.timingFunction = defaultCurve;</span><br><span class="line">        opacityAnimation.removedOnCompletion = NO;</span><br><span class="line">        opacityAnimation.fillMode = kCAFillModeForwards;</span><br><span class="line">        </span><br><span class="line">        // 有一个位置问题，ASDK使用animationGroup 仅显示一个。</span><br><span class="line">//        animationGroup.animations = @[scaleAnimation, opacityAnimation,animation];</span><br><span class="line">        [pulsingLayer addAnimation:scaleAnimation forKey:@&quot;plulsing&quot;];</span><br><span class="line">        [pulsingLayer addAnimation:animation forKey:@&quot;dsdasdasd&quot;];</span><br><span class="line">        [pulsingLayer addAnimation:opacityAnimation forKey:@&quot;plulsidsadang&quot;];</span><br><span class="line">        [animationLayer addSublayer:pulsingLayer];</span><br><span class="line">        [self.rippleArray addObject:pulsingLayer];</span><br><span class="line">        [self.rippleCircleArray addObject:lay];</span><br><span class="line">    &#125;</span><br><span class="line">    _animationLayer = animationLayer;</span><br><span class="line">    [self.coverPictureShadowNode.layer addSublayer:animationLayer];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>停止动画：</p>
<p>​    单纯移除动画会导致旋转归零，产生视觉不适。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)updateCoverPictureRotating &#123;</span><br><span class="line">    if (!_palybtnNode.selected) &#123;</span><br><span class="line">        // 停止动画</span><br><span class="line">        CFTimeInterval pausedTime = [self.coverPictureNode.layer convertTime:CACurrentMediaTime() fromLayer:nil];</span><br><span class="line">        self.coverPictureNode.layer.speed = 0.0;</span><br><span class="line">        self.coverPictureNode.layer.timeOffset = pausedTime;</span><br><span class="line">        _animationLayer.hidden = YES;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        CFTimeInterval pausedTime = [self.coverPictureNode.layer timeOffset];</span><br><span class="line">        self.coverPictureNode.layer.speed = 1.0;</span><br><span class="line">        self.coverPictureNode.layer.timeOffset = 0.0;</span><br><span class="line">        self.coverPictureNode.layer.beginTime = 0.0;</span><br><span class="line">        CFTimeInterval timeSincePause = [self.coverPictureNode.layer convertTime:CACurrentMediaTime() fromLayer:nil] - pausedTime;</span><br><span class="line">        self.coverPictureNode.layer.beginTime = timeSincePause;</span><br><span class="line">        _animationLayer.hidden = NO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BMMusicPlayer简介"><span class="toc-number">1.</span> <span class="toc-text">BMMusicPlayer简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#仿”爱奇艺”Tabbar的点击切换效果。"><span class="toc-number">1.1.</span> <span class="toc-text">仿”爱奇艺”Tabbar的点击切换效果。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASDK"><span class="toc-number">1.2.</span> <span class="toc-text">ASDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#播放器动画"><span class="toc-number">1.3.</span> <span class="toc-text">播放器动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#截图演示-声音播放部分无法演示"><span class="toc-number">1.4.</span> <span class="toc-text">截图演示(声音播放部分无法演示)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主代码说明"><span class="toc-number">1.5.</span> <span class="toc-text">主代码说明</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&text=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&is_video=false&description=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BMMusicPlayer播放器。仿网易云转动音效&body=Check out this article: http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&title=BMMusicPlayer播放器。仿网易云转动音效"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/12/04/BMMusicPlayer播放器。仿网易云转动音效.html&name=BMMusicPlayer播放器。仿网易云转动音效&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="home"><a class="icon" href=/><i class="fas fa-home fa-lg" aria-hidden="true"></i> HOME</a></a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 BirdMichael
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'birdmichael';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


