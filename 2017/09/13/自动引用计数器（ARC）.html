<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="&amp;#x524D;&amp;#x8A00;&amp;#x200B;    &amp;#x81EA;&amp;#x52A8;&amp;#x5F15;&amp;#x7528;&amp;#x8BA1;&amp;#x6570;&amp;#x5668;&amp;#x662F;&amp;#x6307;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x5BF9;&amp;#x5F15;&amp;#x7528;&amp;#x91C7;&amp;#x53D6;&amp;#x81EA;&amp;#x52A8;&amp;#x6280;&amp;#x6">
<meta property="og:type" content="article">
<meta property="og:title" content="自动引用计数器（ARC）">
<meta property="og:url" content="http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html">
<meta property="og:site_name" content="BirdMichael">
<meta property="og:description" content="&amp;#x524D;&amp;#x8A00;&amp;#x200B;    &amp;#x81EA;&amp;#x52A8;&amp;#x5F15;&amp;#x7528;&amp;#x8BA1;&amp;#x6570;&amp;#x5668;&amp;#x662F;&amp;#x6307;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x5BF9;&amp;#x5F15;&amp;#x7528;&amp;#x91C7;&amp;#x53D6;&amp;#x81EA;&amp;#x52A8;&amp;#x6280;&amp;#x6">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-06-22T09:17:58.811Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自动引用计数器（ARC）">
<meta name="twitter:description" content="&amp;#x524D;&amp;#x8A00;&amp;#x200B;    &amp;#x81EA;&amp;#x52A8;&amp;#x5F15;&amp;#x7528;&amp;#x8BA1;&amp;#x6570;&amp;#x5668;&amp;#x662F;&amp;#x6307;&amp;#x5185;&amp;#x5B58;&amp;#x7BA1;&amp;#x7406;&amp;#x5BF9;&amp;#x5F15;&amp;#x7528;&amp;#x91C7;&amp;#x53D6;&amp;#x81EA;&amp;#x52A8;&amp;#x6280;&amp;#x6">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>自动引用计数器（ARC）</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/09/27/iOS为什么需要注意多线程安全.html"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/09/03/XCode编译器介绍.html"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&text=自动引用计数器（ARC）"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&is_video=false&description=自动引用计数器（ARC）"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=自动引用计数器（ARC）&body=Check out this article: http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&name=自动引用计数器（ARC）&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#引用计数"><span class="toc-number">2.</span> <span class="toc-text">引用计数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生成并持有对象"><span class="toc-number">2.0.1.</span> <span class="toc-text">生成并持有对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-调用方生成并持有对象"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">1.调用方生成并持有对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-调用方生成但不持有对象"><span class="toc-number">2.0.1.2.</span> <span class="toc-text">2.调用方生成但不持有对象</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自动引用计数器规则"><span class="toc-number">3.</span> <span class="toc-text">自动引用计数器规则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#规则"><span class="toc-number">3.1.</span> <span class="toc-text">规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARC的约定"><span class="toc-number">3.2.</span> <span class="toc-text">ARC的约定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么不能申明属性名为newString"><span class="toc-number">3.2.1.</span> <span class="toc-text">为什么不能申明属性名为newString</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自动引用计数器实现"><span class="toc-number">4.</span> <span class="toc-text">自动引用计数器实现</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        自动引用计数器（ARC）
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">BirdMichael</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-09-12T17:20:08.000Z" itemprop="datePublished">2017-09-13</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h1><p>&#x200B;    &#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x662F;&#x6307;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5BF9;&#x5F15;&#x7528;&#x91C7;&#x53D6;&#x81EA;&#x52A8;&#x6280;&#x672F;&#x7684;&#x6280;&#x672F;&#x3002;</p>
<blockquote>
<p>&#x5728;LLVM&#x7F16;&#x8BD1;&#x5668;&#x4E2D;&#x8BBE;&#x7F6E;ARC&#x4E3A;&#x6709;&#x6548;&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x65E0;&#x6570;&#x518D;&#x6B21;&#x952E;&#x5165;<code>retain</code>&#x6216;&#x8005;<code>release</code>&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<h1 id="&#x5F15;&#x7528;&#x8BA1;&#x6570;"><a href="#&#x5F15;&#x7528;&#x8BA1;&#x6570;" class="headerlink" title="&#x5F15;&#x7528;&#x8BA1;&#x6570;"></a>&#x5F15;&#x7528;&#x8BA1;&#x6570;</h1><p>&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7684;&#x601D;&#x8003;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li>&#x81EA;&#x5DF1;&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x81EA;&#x5DF1;&#x6301;&#x6709;&#x3002;</li>
<li>&#x975E;&#x81EA;&#x5DF1;&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x81EA;&#x5DF1;&#x4E5F;&#x80FD;&#x6301;&#x6709;&#x3002;</li>
<li>&#x4E0D;&#x5728;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6301;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x65F6;&#x91CA;&#x653E;&#x3002;</li>
<li>&#x975E;&#x81EA;&#x5DF1;&#x6301;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x65E0;&#x6CD5;&#x91CA;&#x653E;&#x3002;</li>
</ul>
<p>&#x5728;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x4E2D;&#x4E3B;&#x8981;&#x4F1A;&#x5BF9;&#x5E94;&#x5982;&#x4E0B;&#x56DB;&#x4E2A;&#x64CD;&#x4F5C;&#xFF1A;&#x751F;&#x6210;&#xFF0C;&#x6301;&#x6709;&#xFF0C;&#x91CA;&#x653E;&#xFF0C;&#x5E9F;&#x5F03;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x5BF9;&#x8C61;&#x64CD;&#x4F5C;</th>
<th>Object-C&#x65B9;&#x6CD5;</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;</td>
<td>alloc/new/copy/mutableCopy &#x65B9;&#x6CD5;</td>
</tr>
<tr>
<td>&#x6301;&#x6709;&#x5BF9;&#x8C61;</td>
<td>retain &#x65B9;&#x6CD5;</td>
</tr>
<tr>
<td>&#x91CA;&#x653E;&#x5BF9;&#x8C61;</td>
<td>release &#x65B9;&#x6CD5;</td>
</tr>
<tr>
<td>&#x5E9F;&#x5F03;&#x5BF9;&#x8C61;</td>
<td>dealloc &#x65B9;&#x6CD5;</td>
</tr>
</tbody>
</table>
<h3 id="&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;"><a href="#&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;" class="headerlink" title="&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;"></a>&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;</h3><h4 id="1-&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;"><a href="#1-&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;" class="headerlink" title="1.&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;"></a>1.&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x5E76;&#x6301;&#x6709;&#x5BF9;&#x8C61;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)allocObject {</span><br><span class="line">    id obj = [[NSObject alloc] init];</span><br><span class="line">    return obj;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="2-&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x4F46;&#x4E0D;&#x6301;&#x6709;&#x5BF9;&#x8C61;"><a href="#2-&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x4F46;&#x4E0D;&#x6301;&#x6709;&#x5BF9;&#x8C61;" class="headerlink" title="2.&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x4F46;&#x4E0D;&#x6301;&#x6709;&#x5BF9;&#x8C61;"></a>2.&#x8C03;&#x7528;&#x65B9;&#x751F;&#x6210;&#x4F46;&#x4E0D;&#x6301;&#x6709;&#x5BF9;&#x8C61;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)object {</span><br><span class="line">    id obj = [[NSObject alloc] init];</span><br><span class="line">    [obj autorelease];</span><br><span class="line">    return obj;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x5728;&#x65E5;&#x5E38;&#x4F7F;&#x7528; <code>NSMutableArray</code>&#x7C7B;&#x7684;<code>array</code>&#x65B9;&#x6CD5;&#x7B49;&#x5C31;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x8C01;&#x90FD;&#x4E0D;&#x6301;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x901A;&#x8FC7;<code>autorelease</code>&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<h1 id="&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x89C4;&#x5219;"><a href="#&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x89C4;&#x5219;" class="headerlink" title="&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x89C4;&#x5219;"></a>&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x89C4;&#x5219;</h1><h2 id="&#x89C4;&#x5219;"><a href="#&#x89C4;&#x5219;" class="headerlink" title="&#x89C4;&#x5219;"></a>&#x89C4;&#x5219;</h2><h2 id="ARC&#x7684;&#x7EA6;&#x5B9A;"><a href="#ARC&#x7684;&#x7EA6;&#x5B9A;" class="headerlink" title="ARC&#x7684;&#x7EA6;&#x5B9A;"></a>ARC&#x7684;&#x7EA6;&#x5B9A;</h2><h3 id="&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x7533;&#x660E;&#x5C5E;&#x6027;&#x540D;&#x4E3A;newString"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x7533;&#x660E;&#x5C5E;&#x6027;&#x540D;&#x4E3A;newString" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x7533;&#x660E;&#x5C5E;&#x6027;&#x540D;&#x4E3A;newString"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x7533;&#x660E;&#x5C5E;&#x6027;&#x540D;&#x4E3A;<code>newString</code></h3><p>&#x4F7F;&#x7528;ARC&#x4E4B;&#x540E;&#x4E00;&#x4E2A;&#x8D39;&#x89E3;&#x7684;&#x5730;&#x65B9;&#x662F;&#xFF0C;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x9644;&#x52A0;&#x6807;&#x793A;&#xFF0C;ARC&#x600E;&#x4E48;&#x77E5;&#x9053;&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x4E0D;&#x662F;<code>autorelease</code>&#x7684;&#x5462;&#xFF1F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@interface Sark : NSObject</span><br><span class="line">+ (instancetype)sarkWithMark:(NSString *)mark; // 1</span><br><span class="line">- (instancetype)initWithMark:(NSString *)mark; // 2</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F;&#x975E;ARC&#x65F6;&#x5E38;&#x7528;&#x7684;&#x624B;&#x6BB5;&#xFF0C;1&#x751F;&#x6210;autorelease&#x5BF9;&#x8C61;&#xFF0C;2&#x751F;&#x6210;&#x666E;&#x901A;&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x73B0;&#x5728;ARC&#x4E0D;&#x80FD;&#x8C03;&#x7528;autorelease&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x600E;&#x4E48;&#x80FD;&#x77E5;&#x9053;&#x5462;&#xFF1F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    // ...</span><br><span class="line">    Sark *sark1 = [Sark sarkWithMark:@&quot;&#x8428;&#x8428;&#x8428;&quot;];</span><br><span class="line">    Sark *sark2 = [[Sark alloc] initWithMark:@&quot;&#x8428;&#x8428;&#x8428;&quot;];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528; &#x201C;&#x7EA6;&#x5B9A;&#x201D;&#xFF0C;NS&#x5B9A;&#x4E49;&#x4E86;&#x4E0B;&#x9762;&#x4E09;&#x4E2A;&#x7F16;&#x8BD1;&#x5C5E;&#x6027;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#define NS_RETURNS_RETAINED __attribute__((ns_returns_retained))</span><br><span class="line">#define NS_RETURNS_NOT_RETAINED __attribute__((ns_returns_not_retained))</span><br><span class="line">#define NS_RETURNS_INNER_POINTER __attribute__((objc_returns_inner_pointer))</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E09;&#x4E2A;&#x5C5E;&#x6027;&#x662F;Clang&#x81EA;&#x5DF1;&#x4F7F;&#x7528;&#x7684;&#x6807;&#x793A;&#xFF0C;&#x9664;&#x975E;<code>&#x7279;&#x6B8A;&#x60C5;&#x51B5;</code>&#x4E0D;&#x8981;&#x81EA;&#x5DF1;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x5BF9;&#x7406;&#x89E3;ARC&#x662F;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x7684;&#x3002;<br>&#x8FD9;&#x91CC;&#x8FD8;&#x8981;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;<code>Method family</code></p>
<blockquote>
<p>An Objective-C method may fall into a method family, which is a conventional set of behaviors ascribed to it by the Cocoa conventions.</p>
</blockquote>
<p>&#x6307;&#x7684;&#x662F;&#x547D;&#x540D;&#x4E0A;&#x8868;&#x793A;&#x4E00;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6BD4;&#x5982;<code>- init</code>&#x548C;<code>- initWithMark:</code>&#x90FD;&#x5C5E;&#x4E8E;<code>init</code>&#x7684;family<br>&#x4E8E;&#x662F;&#x4E4E;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x7EA6;&#x5B9A;&#xFF0C;&#x5BF9;&#x4E8E;<code>alloc</code>,<code>init</code>,<code>copy</code>,<code>mutableCopy</code>,<code>new</code>&#x8FD9;&#x51E0;&#x4E2A;&#x5BB6;&#x65CF;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x540E;&#x9762;&#x9ED8;&#x8BA4;&#x52A0;<code>NS_RETURNS_RETAINED</code>&#x6807;&#x8BC6;&#xFF1B;&#x800C;&#x5176;&#x4ED6;&#x4E0D;&#x6307;&#x540D;&#x6807;&#x8BC6;&#x7684;family&#x7684;&#x65B9;&#x6CD5;&#x9ED8;&#x8BA4;&#x6DFB;&#x52A0;<code>NS_RETURNS_NOT_RETAINED</code>&#x6807;&#x8BC6;<br>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x521A;&#x624D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x7F16;&#x8BD1;&#x5668;&#x770B;&#x6765;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@interface Sark : NSObject</span><br><span class="line">+ (instancetype)sarkWithMark:(NSString *)mark NS_RETURNS_NOT_RETAINED; // 1</span><br><span class="line">- (instancetype)initWithMark:(NSString *)mark NS_RETURNS_RETAINED; // 2</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;ARC&#x4E0B;&#x9762;&#xFF0C;&#x4E0D;&#x80FD;&#x628A;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x5B9A;&#x4E49;&#x6210;&#x540D;&#x5B57;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, copy) NSString *newString; // &#x7F16;&#x8BD1;&#x5668;&#x4E0D;&#x5141;&#x8BB8;</span><br></pre></td></tr></table></figure>
<p><code>- newString</code>&#x5C31;&#x6210;&#x4E86;<code>new</code>&#x5BB6;&#x65CF;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5185;&#x5B58;&#x5C31;&#x4E0D;&#x5BF9;&#x4E86;<br>&#x5BF9;&#x4E8E;<code>NS_RETURNS_INNER_POINTER</code>&#x8FD9;&#x8D27;&#xFF0C;&#x4E3B;&#x8981;&#x4F7F;&#x7528;&#x5728;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;<strong>&#x5185;&#x90E8;C&#x6307;&#x9488;</strong>&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;NSString&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (__strong const char *)UTF8String NS_RETURNS_INNER_POINTER;</span><br></pre></td></tr></table></figure>
<p>&#x5C31;&#x4F7F;&#x7528;&#x4E86;&#x8FD9;&#x4E2A;&#x6807;&#x8BC6;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x4E0D;&#x6DF1;&#x5165;&#x7814;&#x7A76;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x4E0A;&#x6587;&#x6863;&#xFF1A;</p>
<blockquote>
<p>An Objective-C method returning a non-retainable pointer may be annotated with the objc_returns_inner_pointer attribute to indicate that it returns a handle to the internal data of an object, and that this reference will be invalidated if the object is destroyed. When such a message is sent to an object, the object&#x2019;s lifetime will be extended until at least the earliest of:<br>the last use of the returned pointer, or any pointer derived from it, in the calling function or<br>the autorelease pool is restored to a previous state.</p>
</blockquote>
<h1 id="&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x5B9E;&#x73B0;"><a href="#&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x5B9E;&#x73B0;" class="headerlink" title="&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x5B9E;&#x73B0;"></a>&#x81EA;&#x52A8;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x5668;&#x5B9E;&#x73B0;</h1><p>&#x200B;    &#x901A;&#x8FC7;<code>__strong</code>&#x4FEE;&#x9970;&#x7B26;&#xFF0C;&#x4E0D;&#x5FC5;&#x518D;&#x6B21;&#x952E;&#x5165;<code>retain</code>&#x548C;<code>release</code>&#x3002;&#x4F7F;&#x5F97;ARC&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5E76;&#x7B80;&#x5355;&#x7684;&#x7F16;&#x7A0B;&#x9075;&#x5FAA;<code>Object-C</code>&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7684;&#x601D;&#x8003;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x200B;    &#x201C;&#x81EA;&#x5DF1;&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x81EA;&#x5DF1;&#x6301;&#x6709;&#x201D;&#x548C;&#x2019;&#x2019;&#x975E;&#x81EA;&#x5DF1;&#x751F;&#x6210;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x81EA;&#x5DF1;&#x4E5F;&#x80FD;&#x6301;&#x6709;&#x2019;&#x2019;&#x53EA;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x5BF9;&#x5E26;<code>__stong</code>&#x4FEE;&#x9970;&#x7B26;&#x7684;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x4FBF;&#x53EF;&#x4EE5;&#x8FBE;&#x6210;&#x3002;&#x901A;&#x8FC7;&#x5E9F;&#x5F03;&#x5E26;<code>__strong</code>&#x4FEE;&#x9970;&#x7B26;&#x7684;&#x53D8;&#x91CF;(&#x53D8;&#x91CF;&#x4F5C;&#x7528;&#x57DF;&#x7ED3;&#x675F;&#x6216;&#x662F;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x6240;&#x5C5E;&#x5BF9;&#x8C61;&#x5E9F;&#x5F03;)&#x6216;&#x8005;&#x5BF9;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x2019;&#x2019;&#x4E0D;&#x5728;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6301;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x65F6;&#x91CA;&#x653E;&#x3002;&#x2019;&#x2019;&#x975E;&#x81EA;&#x5DF1;&#x6301;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x65E0;&#x6CD5;&#x91CA;&#x653E;&#x2019;&#x2019;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x5FC5;&#x518D;&#x6B21;&#x952E;&#x5165;<code>release</code>&#xFF0C;&#x6240;&#x4EE5;&#x539F;&#x672C;&#x5C31;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x3002;</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#引用计数"><span class="toc-number">2.</span> <span class="toc-text">引用计数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生成并持有对象"><span class="toc-number">2.0.1.</span> <span class="toc-text">生成并持有对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-调用方生成并持有对象"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">1.调用方生成并持有对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-调用方生成但不持有对象"><span class="toc-number">2.0.1.2.</span> <span class="toc-text">2.调用方生成但不持有对象</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自动引用计数器规则"><span class="toc-number">3.</span> <span class="toc-text">自动引用计数器规则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#规则"><span class="toc-number">3.1.</span> <span class="toc-text">规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARC的约定"><span class="toc-number">3.2.</span> <span class="toc-text">ARC的约定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么不能申明属性名为newString"><span class="toc-number">3.2.1.</span> <span class="toc-text">为什么不能申明属性名为newString</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自动引用计数器实现"><span class="toc-number">4.</span> <span class="toc-text">自动引用计数器实现</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&text=自动引用计数器（ARC）"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&is_video=false&description=自动引用计数器（ARC）"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=自动引用计数器（ARC）&body=Check out this article: http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&title=自动引用计数器（ARC）"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/09/13/自动引用计数器（ARC）.html&name=自动引用计数器（ARC）&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 BirdMichael
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-37473492-6', 'auto');
        ga('send', 'pageview');
    </script>


    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'birdmichael';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


